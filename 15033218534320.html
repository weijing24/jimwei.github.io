<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  文件设置 - 小菜鸡儿
  
  </title>
 <meta name="description" content="">
 <link href="atom.xml" rel="alternate" title="小菜鸡儿" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">小菜鸡儿</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; 小菜鸡儿</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>卓越班学习</label></li>

          
            <li><a title="ELF和a.out文件格式的比较" href="15038328822812.html">ELF和a.out文件格式的比较</a></li>
          
            <li><a title="linux多线程编程入门" href="15038316827096.html">linux多线程编程入门</a></li>
          
            <li><a title="linux进程编程入门" href="15038316680304.html">linux进程编程入门</a></li>
          
            <li><a title="shell系统管理" href="15038311430982.html">shell系统管理</a></li>
          
            <li><a title="shell编程入门" href="15038311023811.html">shell编程入门</a></li>
          
            <li><a title="shell网络管理" href="15038310714574.html">shell网络管理</a></li>
          
            <li><a title="wait和waitpid详解" href="15033229130846.html">wait和waitpid详解</a></li>
          
            <li><a title="信号" href="15033227238921.html">信号</a></li>
          
            <li><a title="僵尸进程和孤儿进程" href="15033226512813.html">僵尸进程和孤儿进程</a></li>
          
            <li><a title="共享内存" href="15033226237472.html">共享内存</a></li>
          
            <li><a title="基于TCP的字符串传输程序" href="15033223148818.html">基于TCP的字符串传输程序</a></li>
          
            <li><a title="文件搜索" href="15033220404521.html">文件搜索</a></li>
          
            <li><a title="文件比较" href="15033218983068.html">文件比较</a></li>
          
            <li><a title="文件编辑" href="15033218793219.html">文件编辑</a></li>
          
            <li><a title="文件设置" href="15033218534320.html">文件设置</a></li>
          
            <li><a title="系统文件操作开发" href="15033218072587.html">系统文件操作开发</a></li>
          
            <li><a title="系统环境变量" href="15033217888989.html">系统环境变量</a></li>
          
            <li><a title="静态库和共享库开发" href="%E9%9D%99%E6%80%81%E5%BA%93%E5%92%8C%E5%85%B1%E4%BA%AB%E5%BA%93%E5%BC%80%E5%8F%91.html">静态库和共享库开发</a></li>
          

      
        <li class="divider"></li>
        <li><label>坑</label></li>

          
            <li><a title="数据库非正常关闭导致无法启动问题" href="15033220957416.html">数据库非正常关闭导致无法启动问题</a></li>
          
            <li><a title="解决virtualbox安装增强工具失败的问题" href="15033217564988.html">解决virtualbox安装增强工具失败的问题</a></li>
          
            <li><a title="记一次ftp服务器搭建走过的坑" href="15033217230950.html">记一次ftp服务器搭建走过的坑</a></li>
          
            <li><a title="记一次mysql主从一致校验走过的坑" href="15033215794872.html">记一次mysql主从一致校验走过的坑</a></li>
          

      
        <li class="divider"></li>
        <li><label>日常运维</label></li>

          
            <li><a title="megacli 常用命令" href="15044164651416.html">megacli 常用命令</a></li>
          
            <li><a title="dns服务器报错解决" href="15038329582108.html">dns服务器报错解决</a></li>
          
            <li><a title="docker随谈" href="15038329005848.html">docker随谈</a></li>
          
            <li><a title="i节点，容易被人遗忘的节点" href="15038322315997.html">i节点，容易被人遗忘的节点</a></li>
          
            <li><a title="libc.so.6被删后导致系统无法使用的原因及解决方法" href="15038321032705.html">libc.so.6被删后导致系统无法使用的原因及解决方法</a></li>
          
            <li><a title="linux下nginx模块开发入门" href="15038318990451.html">linux下nginx模块开发入门</a></li>
          
            <li><a title="Linux下配置rsync服务器" href="15038318551859.html">Linux下配置rsync服务器</a></li>
          
            <li><a title="mysql初始化" href="15038316518471.html">mysql初始化</a></li>
          
            <li><a title="nagios安装" href="15038316187109.html">nagios安装</a></li>
          
            <li><a title="nagios配置" href="15038315676757.html">nagios配置</a></li>
          
            <li><a title="nginx、mysql、php等各编译参数查询" href="15038315492978.html">nginx、mysql、php等各编译参数查询</a></li>
          
            <li><a title="nginx性能优化技巧" href="15038314081873.html">nginx性能优化技巧</a></li>
          
            <li><a title="php安装memcache扩展" href="15038313472966.html">php安装memcache扩展</a></li>
          
            <li><a title="puppet和ansible比较" href="15038313193415.html">puppet和ansible比较</a></li>
          
            <li><a title="puppet学习笔记(二)" href="15038312823109.html">puppet学习笔记(二)</a></li>
          
            <li><a title="puppet学习笔记（一）" href="15038311899167.html">puppet学习笔记（一）</a></li>
          
            <li><a title="ssh大坑" href="15038309933322.html">ssh大坑</a></li>
          
            <li><a title="svn同步大坑" href="15038308908725.html">svn同步大坑</a></li>
          
            <li><a title="svn服务器搭建与迁移" href="15038308118838.html">svn服务器搭建与迁移</a></li>
          
            <li><a title="ubuntu mysql5.7源码安装" href="15033230940135.html">ubuntu mysql5.7源码安装</a></li>
          
            <li><a title="ubuntu php5.6源码安装" href="15033230316456.html">ubuntu php5.6源码安装</a></li>
          
            <li><a title="ubuntu下nginx的安裝" href="15033229668634.html">ubuntu下nginx的安裝</a></li>
          
            <li><a title="ubuntu安装php常见错误集锦" href="15033229497885.html">ubuntu安装php常见错误集锦</a></li>
          
            <li><a title="vim常用命令" href="15033229297218.html">vim常用命令</a></li>
          
            <li><a title="使用RAID进行磁盘管理" href="15033227857622.html">使用RAID进行磁盘管理</a></li>
          
            <li><a title="使用virt-manager创建和管理虚拟机" href="15033227559982.html">使用virt-manager创建和管理虚拟机</a></li>
          
            <li><a title="关于mysqld_safe" href="15033226078265.html">关于mysqld_safe</a></li>
          
            <li><a title="安装linux各种桌面环境" href="15033222846104.html">安装linux各种桌面环境</a></li>
          
            <li><a title="常用软件编译参数以及软件地址" href="15033222695994.html">常用软件编译参数以及软件地址</a></li>
          
            <li><a title="打造属于自己的vim利器" href="15033222443468.html">打造属于自己的vim利器</a></li>
          
            <li><a title="搭建本地yum源服务器" href="15033221654695.html">搭建本地yum源服务器</a></li>
          

      
        <li class="divider"></li>
        <li><label>http</label></li>

          
            <li><a title="HTTP协议 (七) Cookie" href="15038327056467.html">HTTP协议 (七) Cookie</a></li>
          
            <li><a title="HTTP协议 (六) 状态码详解" href="15038326831174.html">HTTP协议 (六) 状态码详解</a></li>
          
            <li><a title="HTTP协议 (五) 代理" href="15038326274764.html">HTTP协议 (五) 代理</a></li>
          
            <li><a title="HTTP协议 (四) 缓存" href="15038325535184.html">HTTP协议 (四) 缓存</a></li>
          
            <li><a title="HTTP协议 (三) 压缩" href="15038324866170.html">HTTP协议 (三) 压缩</a></li>
          
            <li><a title="HTTP协议 (二) 基本认证" href="15038324138209.html">HTTP协议 (二) 基本认证</a></li>
          
            <li><a title="HTTP协议 (一) HTTP协议详解" href="15038322654511.html">HTTP协议 (一) HTTP协议详解</a></li>
          

      
        <li class="divider"></li>
        <li><label>监控</label></li>

          
            <li><a title="zabbix安装排错过程" href="15033228802565.html">zabbix安装排错过程</a></li>
          

      
        <li class="divider"></li>
        <li><label>容器</label></li>

          
            <li><a title="制作nginx和php的rpm包" href="15033225667618.html">制作nginx和php的rpm包</a></li>
          

      
        <li class="divider"></li>
        <li><label>web服务器</label></li>

          
            <li><a title="图解正向代理、反向代理、透明代理" href="15033223691311.html">图解正向代理、反向代理、透明代理</a></li>
          
            <li><a title="详解apache的allow和deny" href="15033200332645.html">详解apache的allow和deny</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>卓越班学习</span></li>
                        
                          <li><a title="ELF和a.out文件格式的比较" href="15038328822812.html">ELF和a.out文件格式的比较</a></li>
                        
                          <li><a title="linux多线程编程入门" href="15038316827096.html">linux多线程编程入门</a></li>
                        
                          <li><a title="linux进程编程入门" href="15038316680304.html">linux进程编程入门</a></li>
                        
                          <li><a title="shell系统管理" href="15038311430982.html">shell系统管理</a></li>
                        
                          <li><a title="shell编程入门" href="15038311023811.html">shell编程入门</a></li>
                        
                          <li><a title="shell网络管理" href="15038310714574.html">shell网络管理</a></li>
                        
                          <li><a title="wait和waitpid详解" href="15033229130846.html">wait和waitpid详解</a></li>
                        
                          <li><a title="信号" href="15033227238921.html">信号</a></li>
                        
                          <li><a title="僵尸进程和孤儿进程" href="15033226512813.html">僵尸进程和孤儿进程</a></li>
                        
                          <li><a title="共享内存" href="15033226237472.html">共享内存</a></li>
                        
                          <li><a title="基于TCP的字符串传输程序" href="15033223148818.html">基于TCP的字符串传输程序</a></li>
                        
                          <li><a title="文件搜索" href="15033220404521.html">文件搜索</a></li>
                        
                          <li><a title="文件比较" href="15033218983068.html">文件比较</a></li>
                        
                          <li><a title="文件编辑" href="15033218793219.html">文件编辑</a></li>
                        
                          <li><a title="文件设置" href="15033218534320.html">文件设置</a></li>
                        
                          <li><a title="系统文件操作开发" href="15033218072587.html">系统文件操作开发</a></li>
                        
                          <li><a title="系统环境变量" href="15033217888989.html">系统环境变量</a></li>
                        
                          <li><a title="静态库和共享库开发" href="%E9%9D%99%E6%80%81%E5%BA%93%E5%92%8C%E5%85%B1%E4%BA%AB%E5%BA%93%E5%BC%80%E5%8F%91.html">静态库和共享库开发</a></li>
                        

                    
                      <li class="side-title"><span>坑</span></li>
                        
                          <li><a title="数据库非正常关闭导致无法启动问题" href="15033220957416.html">数据库非正常关闭导致无法启动问题</a></li>
                        
                          <li><a title="解决virtualbox安装增强工具失败的问题" href="15033217564988.html">解决virtualbox安装增强工具失败的问题</a></li>
                        
                          <li><a title="记一次ftp服务器搭建走过的坑" href="15033217230950.html">记一次ftp服务器搭建走过的坑</a></li>
                        
                          <li><a title="记一次mysql主从一致校验走过的坑" href="15033215794872.html">记一次mysql主从一致校验走过的坑</a></li>
                        

                    
                      <li class="side-title"><span>日常运维</span></li>
                        
                          <li><a title="megacli 常用命令" href="15044164651416.html">megacli 常用命令</a></li>
                        
                          <li><a title="dns服务器报错解决" href="15038329582108.html">dns服务器报错解决</a></li>
                        
                          <li><a title="docker随谈" href="15038329005848.html">docker随谈</a></li>
                        
                          <li><a title="i节点，容易被人遗忘的节点" href="15038322315997.html">i节点，容易被人遗忘的节点</a></li>
                        
                          <li><a title="libc.so.6被删后导致系统无法使用的原因及解决方法" href="15038321032705.html">libc.so.6被删后导致系统无法使用的原因及解决方法</a></li>
                        
                          <li><a title="linux下nginx模块开发入门" href="15038318990451.html">linux下nginx模块开发入门</a></li>
                        
                          <li><a title="Linux下配置rsync服务器" href="15038318551859.html">Linux下配置rsync服务器</a></li>
                        
                          <li><a title="mysql初始化" href="15038316518471.html">mysql初始化</a></li>
                        
                          <li><a title="nagios安装" href="15038316187109.html">nagios安装</a></li>
                        
                          <li><a title="nagios配置" href="15038315676757.html">nagios配置</a></li>
                        
                          <li><a title="nginx、mysql、php等各编译参数查询" href="15038315492978.html">nginx、mysql、php等各编译参数查询</a></li>
                        
                          <li><a title="nginx性能优化技巧" href="15038314081873.html">nginx性能优化技巧</a></li>
                        
                          <li><a title="php安装memcache扩展" href="15038313472966.html">php安装memcache扩展</a></li>
                        
                          <li><a title="puppet和ansible比较" href="15038313193415.html">puppet和ansible比较</a></li>
                        
                          <li><a title="puppet学习笔记(二)" href="15038312823109.html">puppet学习笔记(二)</a></li>
                        
                          <li><a title="puppet学习笔记（一）" href="15038311899167.html">puppet学习笔记（一）</a></li>
                        
                          <li><a title="ssh大坑" href="15038309933322.html">ssh大坑</a></li>
                        
                          <li><a title="svn同步大坑" href="15038308908725.html">svn同步大坑</a></li>
                        
                          <li><a title="svn服务器搭建与迁移" href="15038308118838.html">svn服务器搭建与迁移</a></li>
                        
                          <li><a title="ubuntu mysql5.7源码安装" href="15033230940135.html">ubuntu mysql5.7源码安装</a></li>
                        
                          <li><a title="ubuntu php5.6源码安装" href="15033230316456.html">ubuntu php5.6源码安装</a></li>
                        
                          <li><a title="ubuntu下nginx的安裝" href="15033229668634.html">ubuntu下nginx的安裝</a></li>
                        
                          <li><a title="ubuntu安装php常见错误集锦" href="15033229497885.html">ubuntu安装php常见错误集锦</a></li>
                        
                          <li><a title="vim常用命令" href="15033229297218.html">vim常用命令</a></li>
                        
                          <li><a title="使用RAID进行磁盘管理" href="15033227857622.html">使用RAID进行磁盘管理</a></li>
                        
                          <li><a title="使用virt-manager创建和管理虚拟机" href="15033227559982.html">使用virt-manager创建和管理虚拟机</a></li>
                        
                          <li><a title="关于mysqld_safe" href="15033226078265.html">关于mysqld_safe</a></li>
                        
                          <li><a title="安装linux各种桌面环境" href="15033222846104.html">安装linux各种桌面环境</a></li>
                        
                          <li><a title="常用软件编译参数以及软件地址" href="15033222695994.html">常用软件编译参数以及软件地址</a></li>
                        
                          <li><a title="打造属于自己的vim利器" href="15033222443468.html">打造属于自己的vim利器</a></li>
                        
                          <li><a title="搭建本地yum源服务器" href="15033221654695.html">搭建本地yum源服务器</a></li>
                        

                    
                      <li class="side-title"><span>http</span></li>
                        
                          <li><a title="HTTP协议 (七) Cookie" href="15038327056467.html">HTTP协议 (七) Cookie</a></li>
                        
                          <li><a title="HTTP协议 (六) 状态码详解" href="15038326831174.html">HTTP协议 (六) 状态码详解</a></li>
                        
                          <li><a title="HTTP协议 (五) 代理" href="15038326274764.html">HTTP协议 (五) 代理</a></li>
                        
                          <li><a title="HTTP协议 (四) 缓存" href="15038325535184.html">HTTP协议 (四) 缓存</a></li>
                        
                          <li><a title="HTTP协议 (三) 压缩" href="15038324866170.html">HTTP协议 (三) 压缩</a></li>
                        
                          <li><a title="HTTP协议 (二) 基本认证" href="15038324138209.html">HTTP协议 (二) 基本认证</a></li>
                        
                          <li><a title="HTTP协议 (一) HTTP协议详解" href="15038322654511.html">HTTP协议 (一) HTTP协议详解</a></li>
                        

                    
                      <li class="side-title"><span>监控</span></li>
                        
                          <li><a title="zabbix安装排错过程" href="15033228802565.html">zabbix安装排错过程</a></li>
                        

                    
                      <li class="side-title"><span>容器</span></li>
                        
                          <li><a title="制作nginx和php的rpm包" href="15033225667618.html">制作nginx和php的rpm包</a></li>
                        

                    
                      <li class="side-title"><span>web服务器</span></li>
                        
                          <li><a title="图解正向代理、反向代理、透明代理" href="15033223691311.html">图解正向代理、反向代理、透明代理</a></li>
                        
                          <li><a title="详解apache的allow和deny" href="15033200332645.html">详解apache的allow和deny</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 <div class="markdown-body">
<h1>文件设置</h1>

<h3 id="toc_0">背景知识</h3>

<p>　　文件系统是操作系统中负责存取和管理信息的模块，它用统一的方式管理用户和系统信息的存储、检索、更新、共享和保护，并为用户提供一整套方便有效的文件使用和操作方法。文件这一术语不但反映了用户概念中的逻辑结构，而且和存放它的辅助存储器（也称文件存储器）的存储结构紧密相关。所以，同一个文件必须从逻辑文件和物理文件两个侧面来观察它。<br/>
　　对于用户来说，可按自己的愿望并遵循文件系统的规则来定义文件信息的逻辑结构，由文件系统提供“按名存取”来实现对用户文件信息的存储和检索。可见，使用者在处理他的信息时，只需关心所执行的文件操作及文件的逻辑结构，而不必涉及存储结构。但对文件系统本身来说，必须采用特定的数据结构和有效算法，实现文件的逻辑结构到存储结构的映射，实现对文件存储空间和用户信息的管理，提供多种存取方法。例如，用户希望与具体的存储硬件无关，使用路径名、文件名、文件内位移就可以进行数据(字节、字段或记录)的读、写、改、删操作；而作为实现这些功能的文件系统来说，它的工作与存储硬件紧密相关，是根据用户的文件操作请求，转化为对设备(磁盘)上的信息按照所在的位置(设备号、柱面号、磁道号和物理块号)进行寻址、读写和控制。所以，<strong>文件系统的功能就是要在逻辑文件与物理文件、逻辑地址与物理地址、逻辑结构与物理结构、逻辑操作与物理操作之间实现转换，保证存取速度快、存储空间利用率高、数据可共享、安全可靠性好。</strong><br/>
　　文件系统的基本功能之一是负责文件目录的建立、维护和检索，要求编排的目录便于查找、防止冲突，目录的检索方便迅速。由于文件目录也需要永久保存，所以，把文件目录也组织成文件存放在磁盘上称目录文件。有了文件目录后，就可实现文件的“按名存取”。当用户要求存取某个文件时，系统查找文件目录并比较文件名就可找到所寻文件的文件控制块(文件目录项)。然后，再通过文件目录项指出文件的文件信息相对位置或文件信息首块物理位置等就能依次存取文件信息。<br/>
　　</p>

<h4 id="toc_1">1.获取文件的user、group、others访问权限</h4>

<p>任务描述：</p>

<ul>
<li>输入文件名，分别打印该文件的user、group、others的访问权限，以rwx和数字的方式打印</li>
</ul>

<p>相关知识：<br/>
通过访问struct stat结构体中的st_mode成员，可以获取文件访问权限<br/>
获取文件属性int stat(const char *restrict pathname,struct stat *restrict buf)<br/>
　　  pathname:文件的绝对路径名，buf：存有文件属性的stat结构体<br/>
　　　stat结构体：</p>

<blockquote>
<pre><code class="language-text">struct stat {
    mode_t     st_mode;       //文件的类型和存取的权限
    ino_t      st_ino;       //inode节点号
    dev_t      st_dev;        //设备号码
    dev_t      st_rdev;       //特殊设备号码
    nlink_t    st_nlink;      //文件的连接数
    uid_t      st_uid;        //文件所有者
    gid_t      st_gid;        //文件所有者对应的组
    off_t      st_size;       //普通文件，对应的文件字节数
    time_t     st_atime;      //文件最后被访问的时间
    time_t     st_mtime;      //文件内容最后被修改的时间
    time_t     st_ctime;      //文件状态改变时间
    blksize_t st_blksize;    //文件内容对应的块大小
    blkcnt_t   st_blocks;     //文件内容对应的块数量
};
</code></pre>
</blockquote>

<p>user、group、others的读/写/执行9个权限在st_mode中各占一个bit位，如果bit位值为1，就表示文件具有该权限，如果为0，则表示文件不具有该权限。<br/>
使用st_mode &amp; S_IRUSR 可以获得文件的用户是否具有读的权限位，如果该位为1，则该文件可以被所属用户进行读取，否则不能被读取。</p>

<p>main.c:</p>

<blockquote>
<pre><code class="language-text">#include &quot;stdio.h&quot;
#include &quot;stdlib.h&quot;
#include &quot;sys/stat.h&quot;
#include &quot;unistd.h&quot;
struct stat buf;
int main(int argc,char *argv[]){
    int i;
    if(argc!=2){
        perror(&quot;argc error\n&quot;);
        exit(1);
    }
    if(stat(argv[1],&amp;buf)!=0){
        perror(&quot;stat error\n&quot;);
        exit(1);
    }
    if(buf.st_mode&amp;S_IRUSR)
        printf(&quot;user read\n&quot;);
    if(buf.st_mode&amp;S_IWUSR)
        printf(&quot;user write\n&quot;);
    if(buf.st_mode&amp;S_IXUSR)
        printf(&quot;user chmod\n&quot;);
    if(buf.st_mode&amp;S_IRGRP)
        printf(&quot;group read\n&quot;);
    if(buf.st_mode&amp;S_IWGRP)
        printf(&quot;group write\n&quot;);
    if(buf.st_mode&amp;S_IXGRP)
        printf(&quot;group chmod\n&quot;);
    if(buf.st_mode&amp;S_IROTH)
        printf(&quot;other read\n&quot;);
    if(buf.st_mode&amp;S_IWOTH)
        printf(&quot;other write\n&quot;);
    if(buf.st_mode&amp;S_IXOTH)
        printf(&quot;other chmod\n&quot;);
    printf(&quot;======================\n&quot;);
    for(i=2;i&gt;=0;i--){
        if(buf.st_mode&amp;1&lt;&lt;(i*3+2))//依次取权限位的8\5\2的mode
            printf(&quot;r&quot;);
        else
            printf(&quot;-&quot;);
        if(buf.st_mode&amp;1&lt;&lt;(i*3+1))//依次取权限位的7\4\1的mode
            printf(&quot;w&quot;);
        else
            printf(&quot;-&quot;);
        if(buf.st_mode&amp;1&lt;&lt;(i*3+0))//依次取权限位的6\3\0的mode
            printf(&quot;x&quot;);
        else
            printf(&quot;-&quot;);
    }
    printf(&quot;\n&quot;);
    printf(&quot;======================\n&quot;);
    printf(&quot;The file authority is %o\n&quot;,buf.st_mode&amp;0777);
    return 0;
}
</code></pre>
</blockquote>

<h4 id="toc_2">2.关闭文件的group的写权限和other的写权限</h4>

<p>任务描述：</p>

<ul>
<li>输入文件名，打印输出该文件初始的group和others权限，以及关闭写权限后的group和others权限</li>
</ul>

<p>相关知识：</p>

<ul>
<li>stat获取文件权限，chmod关闭group和others的写权限</li>
<li>int chmod（const char *path，mode_t mode）,chmod（）会依照参数mode权限来更改参数path指定文件的权限</li>
<li>S_ISUID 04000 文件的（set user-id on execution）位</li>
<li>S_ISGID 02000 文件的（set group-id on execution）位</li>
<li>S_ISVTX 01000 文件的sticky位</li>
<li>S_IRUSR（S_IREAD） 00400 文件所有者具可读取权限</li>
<li>S_IWUSR（S_IWRITE）00200 文件所有者具可写入权限</li>
<li>S_IXUSR（S_IEXEC） 00100 文件所有者具可执行权限</li>
<li>S_IRGRP 00040 用户组具可读取权限</li>
<li>S_IWGRP 00020 用户组具可写入权限</li>
<li>S_IXGRP 00010 用户组具可执行权限</li>
<li>S_IROTH 00004 其他用户具可读取权限</li>
<li>S_IWOTH 00002 其他用户具可写入权限</li>
<li><p>S_IXOTH 00001 其他用户具可执行权限</p></li>
<li><p><strong>要关闭某个权限位，只需对该权限位取反，然后与文件原来的权限位进行&amp;操作即可。</strong></p></li>
</ul>

<p>main.c:</p>

<blockquote>
<pre><code class="language-text">#include &quot;stdio.h&quot;
#include &quot;stdlib.h&quot;
#include &quot;sys/stat.h&quot;
#include &quot;unistd.h&quot;
#include &quot;sys/types.h&quot;
struct stat buf;
int main(int argc,char *argv[]){
    int i;
    if(argc!=2){
        perror(&quot;argc error\n&quot;);
        exit(1);
    }
    if(stat(argv[1],&amp;buf)!=0){
        perror(&quot;stat error\n&quot;);
        exit(1);
    }
    for(i=2;i&gt;=0;i--){
        if(buf.st_mode&amp;1&lt;&lt;(i*3+2))
            printf(&quot;r&quot;);
        else
            printf(&quot;-&quot;);
        if(buf.st_mode&amp;1&lt;&lt;(i*3+1))
            printf(&quot;w&quot;);
        else
            printf(&quot;-&quot;);
        if(buf.st_mode&amp;1&lt;&lt;(i*3+0))
            printf(&quot;x&quot;);
        else
            printf(&quot;-&quot;);
    }
    printf(&quot;\n&quot;);
    printf(&quot;The file authority is:%o\n&quot;,buf.st_mode&amp;0777);
    printf(&quot;after chmod\n&quot;);
    chmod(argv[1],buf.st_mode&amp;=~S_IWGRP);//group可写取反就是关闭写权限
    chmod(argv[1],buf.st_mode&amp;=~S_IWOTH);//others可写取反就是关闭写权限
    /*由于文件权限已经更改，所以需要重新获取文件属性*/
    if(stat(argv[1],&amp;buf)!=0){
        perror(&quot;stat error\n&quot;);
        exit (1);
    }
    for(i=2;i&gt;=0;i--){
        if(buf.st_mode&amp;1&lt;&lt;(i*3+2))
            printf(&quot;r&quot;);
        else
            printf(&quot;-&quot;);
        if(buf.st_mode&amp;1&lt;&lt;(i*3+1))
            printf(&quot;w&quot;);
        else
            printf(&quot;-&quot;);
        if(buf.st_mode&amp;1&lt;&lt;(i*3+0))
            printf(&quot;x&quot;);
        else
            printf(&quot;-&quot;);
    }
    printf(&quot;\n&quot;);
    printf(&quot;The file authority is:%o\n&quot;,buf.st_mode&amp;0777);
    return 0;
}
</code></pre>
</blockquote>

<h4 id="toc_3">3.设置文件的访问权限为rw-r--r--</h4>

<p>任务描述：</p>

<ul>
<li>输入文件名，打印输出该文件初始权限，以及修改为rw-r--r--后的权限</li>
</ul>

<p>相关知识：<br/>
使用chmod设置文件的多个权限位，对这些权限位进行按位或操作即可</p>

<p>main.c：</p>

<blockquote>
<pre><code class="language-text">#include &quot;stdio.h&quot;
#include &quot;stdlib.h&quot;
#include &quot;sys/stat.h&quot;
#include &quot;unistd.h&quot;
#include &quot;sys/types.h&quot;
struct stat buf;
int main(int argc,char *argv[]){
    int i;
    if(argc!=2){
        perror(&quot;argc error\n&quot;);
        exit(1);
    }
    if(stat(argv[1],&amp;buf)!=0){
        perror(&quot;stat error\n&quot;);
        exit(1);
    }
    for(i=2;i&gt;=0;i--){
        if(buf.st_mode&amp;1&lt;&lt;(i*3+2))
            printf(&quot;r&quot;);
        else
            printf(&quot;-&quot;);
        if(buf.st_mode&amp;1&lt;&lt;(i*3+1))
            printf(&quot;w&quot;);
        else
            printf(&quot;-&quot;);
        if(buf.st_mode&amp;1&lt;&lt;(i*3+0))
            printf(&quot;x&quot;);
        else
            printf(&quot;-&quot;);
    }
    printf(&quot;\n&quot;);
    printf(&quot;The file authority is:%o\n&quot;,buf.st_mode&amp;0777);
    printf(&quot;after chmod\n&quot;);
    chmod(argv[1],buf.st_mode&amp;=S_IRUSR|S_IWUSR|S_IRGRP|S_IROTH);
    if(stat(argv[1],&amp;buf)!=0){
        perror(&quot;stat error\n&quot;);
        exit(1);
    }
    for(i=2;i&gt;=0;i--){
        if(buf.st_mode&amp;1&lt;&lt;(i*3+2))
            printf(&quot;r&quot;);
        else
            printf(&quot;-&quot;);
        if(buf.st_mode&amp;1&lt;&lt;(i*3+1))
            printf(&quot;w&quot;);
        else
            printf(&quot;-&quot;);
        if(buf.st_mode&amp;1&lt;&lt;(i*3+0))
            printf(&quot;x&quot;);
        else
            printf(&quot;-&quot;);
    }
    printf(&quot;\n&quot;);
    printf(&quot;The file authority is:%o\n&quot;,buf.st_mode&amp;0777);
    return 0;
}
</code></pre>
</blockquote>

<h4 id="toc_4">4.获取文件属性</h4>

<p>任务描述：</p>

<ul>
<li>输入文件名，打印输出该文件用户id，组id，大小、最后访问时间、最后修改时间</li>
</ul>

<p>相关知识：<br/>
使用stat函数和stat结构体获取文件属性</p>

<p>main.c:</p>

<blockquote>
<pre><code class="language-text">#include &quot;stdio.h&quot;
#include &quot;stdlib.h&quot;
#include &quot;sys/stat.h&quot;
#include &quot;unistd.h&quot;
#include &quot;sys/types.h&quot;
#include &quot;time.h&quot;
struct stat buf;
int main(int argc,char *argv[]){
    if(argc!=2){
        perror(&quot;argc error\n&quot;);
        exit(1);
    }
    if(stat(argv[1],&amp;buf)!=0){
        perror(&quot;stat error\n&quot;);
        exit(1);
    }
    printf(&quot;user id is :%d\n&quot;,buf.st_uid);
    printf(&quot;group id is :%d\n&quot;,buf.st_gid);
    printf(&quot;file size is:%d\n&quot;,(int)buf.st_size);
    printf(&quot;last access time is:%s&quot;,ctime(&amp;buf.st_atime));
    printf(&quot;lase modify time is:%s&quot;,ctime(&amp;buf.st_mtime));
    return 0;
}
</code></pre>
</blockquote>

<h4 id="toc_5">5.修改文件的组id</h4>

<p>任务描述：</p>

<ul>
<li>输入文件名和新的组id，打印输出该文件原有组id和新的组id</li>
</ul>

<p>相关知识：<br/>
　　int chown(const char *pathname, uid_t owner, gid_t group)：改变文件的所有者的用户ID<br/>
　　　　参数pathname表示文件的路径。<br/>
　　　　参数owner表示新的所有者用户的ID。<br/>
　　　　参数group表示新的组ID。<br/>
　　　　参数owner的值为-1时，文件的所有者ID不发生变化，同样的道理对于组ID也是一样的。<br/>
　　更改文件的所有者是一项需要谨慎处理的操作，因为可能会导致安全问题。因此并不是所有的用户都可以修改文件的所有者ID的。如果需要修改一个文件的所有者ID和组ID，该用户必须是根用户，或者修改文件的进程的有效用户ID等于该文件的ID，也就是说修改必须经过文件所有者授权。</p>

<p>main.c:</p>

<blockquote>
<pre><code class="language-text">#include &quot;stdio.h&quot;
#include &quot;stdlib.h&quot;
#include &quot;sys/stat.h&quot;
#include &quot;unistd.h&quot;
#include &quot;sys/types.h&quot;
#include &quot;time.h&quot;
struct stat buf;
int main(int argc,char *argv[]){
    if(argc!=3){
        perror(&quot;argc error\n&quot;);
        exit(1);
    }
    if(stat(argv[1],&amp;buf)!=0){
        perror(&quot;stat error\n&quot;);
        exit(1);
    }
    printf(&quot;old group id is :%d\n&quot;,buf.st_gid);
    /*参数owner设置为-1表示文件所有者ID/组ID不发生变化*/
    if(chown(argv[1],-1,atoi(argv[2]))!=0){
        perror(&quot;chowm error\n&quot;);
        exit(1);
    }
    if(stat(argv[1],&amp;buf)!=0){
        perror(&quot;stat error\n&quot;);
        exit(1);
    }
    printf(&quot;new group id is :%d\n&quot;,buf.st_gid);
    return 0;
}
</code></pre>
</blockquote>

<h4 id="toc_6">6.修改文件的访问时间和修改时间为当前时间</h4>

<p>任务描述：</p>

<ul>
<li>输入文件名，输出处理前文件的最后访问/修改时间和处理后的最后访问/修改时间</li>
</ul>

<p>相关知识：<br/>
　　int utime(const char * pathname, const struct utimbuf * times)：修改文件访问时间<br/>
　　　　pathname：要修改的文件的路径名称<br/>
　　　　times: 结构体struct utimbuf变量。<br/>
　　　　struct utimbuf结构体如下:<br/>
　　　　struct utimbuf{<br/>
　　　　　　time_t actime;<br/>
　　　　　　time_t modtime;<br/>
　　　　}<br/>
　　　　actime表示文件访问时间，modtime表示文件修改时间。<br/>
　　　　当times是空指针时，文件的访问时间和修改时间都被设置为当前时间。</p>

<p>main.c：</p>

<blockquote>
<pre><code class="language-text">#include &quot;stdio.h&quot;
#include &quot;stdlib.h&quot;
#include &quot;sys/stat.h&quot;
#include &quot;unistd.h&quot;
#include &quot;sys/types.h&quot;
#include &quot;time.h&quot;
struct stat buf;
int main(int argc,char *argv[]){
    if(argc!=2){
        perror(&quot;argc error\n&quot;);
        exit(1);
    }
    if(stat(argv[1],&amp;buf)!=0){
        perror(&quot;stat error\n&quot;);
        exit(1);
    }
    printf(&quot;last access time is:%s&quot;,ctime(&amp;buf.st_atime));
    printf(&quot;lase modify time is:%s&quot;,ctime(&amp;buf.st_mtime));
    if(utime(argv[1],NULL)!=0){
        perror(&quot;utime error\n&quot;);
        exit(1);
    }
    if(stat(argv[1],&amp;buf)!=0){
        perror(&quot;stat error\n&quot;);
        exit(1);
    } 
    printf(&quot;after utime\n&quot;);
    printf(&quot;last access time is:%s&quot;,ctime(&amp;buf.st_atime));
    printf(&quot;lase modify time is:%s&quot;,ctime(&amp;buf.st_mtime));
    return 0;
}
</code></pre>
</blockquote>


</div>

<br /><br />
<hr />

<div class="row clearfix">
  <div class="large-6 columns">
	<div class="text-left" style="padding:15px 0px;">
		
	        <a href="15033218793219.html"  title="Previous Post: 文件编辑">&laquo; 文件编辑</a>
	    
	</div>
  </div>
  <div class="large-6 columns">
	<div class="text-right" style="padding:15px 0px;">
		
	        <a href="15033218072587.html" 
	        title="Next Post: 系统文件操作开发">系统文件操作开发 &raquo;</a>
	    
	</div>
  </div>
</div>

<div class="row">
<div style="padding:0px 0.93em;" class="share-comments">

</div>
</div>
<script type="text/javascript">
	$(function(){
		var currentURL = '15033218534320.html';
		$('#side-nav a').each(function(){
			if($(this).attr('href') == currentURL){
				$(this).parent().addClass('active');
			}
		});
	});
</script>  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    



  













<script src="asset/prism.js"></script>


<style type="text/css">
figure{margin: 0.4em 0;padding: 0;}
  figcaption{text-align:center;}

/* PrismJS 1.14.0
 http://prismjs.com/download.html#themes=prism&languages=markup+css+clike+javascript */
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
    color: black;
    background: none;
    text-shadow: 0 1px white;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
    
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
    
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
    text-shadow: none;
    background:#b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
    text-shadow: none;
    background: #b3d4fc;
}

@media print {
    code[class*="language-"],
    pre[class*="language-"] {
        text-shadow: none;
    }
}

/* Code blocks */
pre[class*="language-"] {
    padding: 1em;
    margin: .5em 0;
    overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
    background: #F7F7F7;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
    padding: .1em;
    border-radius: .3em;
    white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
    color: slategray;
}

.token.punctuation {
    color: #999;
}

.namespace {
    opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
    color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
    color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
    color: #9a6e3a;
    background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
    color: #07a;
}

.token.function,
.token.class-name {
    color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
    color: #e90;
}

.token.important,
.token.bold {
    font-weight: bold;
}
.token.italic {
    font-style: italic;
}

.token.entity {
    cursor: help;
}


pre[class*="language-"].line-numbers {
    position: relative;
    padding-left: 3.8em;
    counter-reset: linenumber;
}

pre[class*="language-"].line-numbers > code {
    position: relative;
    white-space: inherit;
}

.line-numbers .line-numbers-rows {
    position: absolute;
    pointer-events: none;
    top: 0;
    font-size: 100%;
    left: -3.8em;
    width: 3em; /* works for line-numbers below 1000 lines */
    letter-spacing: -1px;
    border-right: 1px solid #999;

    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;

}

    .line-numbers-rows > span {
        pointer-events: none;
        display: block;
        counter-increment: linenumber;
    }

        .line-numbers-rows > span:before {
            content: counter(linenumber);
            color: #999;
            display: block;
            padding-right: 0.8em;
            text-align: right;
        }


</style>
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>


  </body>
</html>
