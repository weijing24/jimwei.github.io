<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  卓越班学习 - 小菜鸡
  
  </title>
 <meta name="description" content="个人博客">
 <link href="atom.xml" rel="alternate" title="小菜鸡" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">小菜鸡</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; 小菜鸡</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>容器</label></li>

          
            <li><a title="制作nginx和php的rpm包" href="15033225667618.html">制作nginx和php的rpm包</a></li>
          

      
        <li class="divider"></li>
        <li><label>web服务器</label></li>

          
            <li><a title="图解正向代理、反向代理、透明代理" href="15033223691311.html">图解正向代理、反向代理、透明代理</a></li>
          
            <li><a title="详解apache的allow和deny" href="15033200332645.html">详解apache的allow和deny</a></li>
          

      
        <li class="divider"></li>
        <li><label>卓越班学习</label></li>

          
            <li><a title="ELF和a.out文件格式的比较" href="15038328822812.html">ELF和a.out文件格式的比较</a></li>
          
            <li><a title="linux多线程编程入门" href="15038316827096.html">linux多线程编程入门</a></li>
          
            <li><a title="linux进程编程入门" href="15038316680304.html">linux进程编程入门</a></li>
          
            <li><a title="shell系统管理" href="15038311430982.html">shell系统管理</a></li>
          
            <li><a title="shell编程入门" href="15038311023811.html">shell编程入门</a></li>
          
            <li><a title="shell网络管理" href="15038310714574.html">shell网络管理</a></li>
          
            <li><a title="wait和waitpid详解" href="15033229130846.html">wait和waitpid详解</a></li>
          
            <li><a title="信号" href="15033227238921.html">信号</a></li>
          
            <li><a title="僵尸进程和孤儿进程" href="15033226512813.html">僵尸进程和孤儿进程</a></li>
          
            <li><a title="共享内存" href="15033226237472.html">共享内存</a></li>
          
            <li><a title="基于TCP的字符串传输程序" href="15033223148818.html">基于TCP的字符串传输程序</a></li>
          
            <li><a title="文件搜索" href="15033220404521.html">文件搜索</a></li>
          
            <li><a title="文件比较" href="15033218983068.html">文件比较</a></li>
          
            <li><a title="文件编辑" href="15033218793219.html">文件编辑</a></li>
          
            <li><a title="文件设置" href="15033218534320.html">文件设置</a></li>
          
            <li><a title="系统文件操作开发" href="15033218072587.html">系统文件操作开发</a></li>
          
            <li><a title="系统环境变量" href="15033217888989.html">系统环境变量</a></li>
          
            <li><a title="静态库和共享库开发" href="%E9%9D%99%E6%80%81%E5%BA%93%E5%92%8C%E5%85%B1%E4%BA%AB%E5%BA%93%E5%BC%80%E5%8F%91.html">静态库和共享库开发</a></li>
          

      
        <li class="divider"></li>
        <li><label>坑</label></li>

          
            <li><a title="<center>数据库非正常关闭导致无法启动问题</center>" href="15033220957416.html"><center>数据库非正常关闭导致无法启动问题</center></a></li>
          
            <li><a title="解决virtualbox安装增强工具失败的问题" href="15033217564988.html">解决virtualbox安装增强工具失败的问题</a></li>
          
            <li><a title="记一次ftp服务器搭建走过的坑" href="15033217230950.html">记一次ftp服务器搭建走过的坑</a></li>
          
            <li><a title="记一次mysql主从一致校验走过的坑" href="15033215794872.html">记一次mysql主从一致校验走过的坑</a></li>
          

      
        <li class="divider"></li>
        <li><label>日常运维</label></li>

          
            <li><a title="dns服务器报错解决" href="15038329582108.html">dns服务器报错解决</a></li>
          
            <li><a title="docker随谈" href="15038329005848.html">docker随谈</a></li>
          
            <li><a title="i节点，容易被人遗忘的节点" href="15038322315997.html">i节点，容易被人遗忘的节点</a></li>
          
            <li><a title="libc.so.6被删后导致系统无法使用的原因及解决方法" href="15038321032705.html">libc.so.6被删后导致系统无法使用的原因及解决方法</a></li>
          
            <li><a title="linux下nginx模块开发入门" href="15038318990451.html">linux下nginx模块开发入门</a></li>
          
            <li><a title="Linux下配置rsync服务器" href="15038318551859.html">Linux下配置rsync服务器</a></li>
          
            <li><a title="mysql初始化" href="15038316518471.html">mysql初始化</a></li>
          
            <li><a title="nagios安装" href="15038316187109.html">nagios安装</a></li>
          
            <li><a title="nagios配置" href="15038315676757.html">nagios配置</a></li>
          
            <li><a title="nginx、mysql、php等各编译参数查询" href="15038315492978.html">nginx、mysql、php等各编译参数查询</a></li>
          
            <li><a title="nginx性能优化技巧" href="15038314081873.html">nginx性能优化技巧</a></li>
          
            <li><a title="php安装memcache扩展" href="15038313472966.html">php安装memcache扩展</a></li>
          
            <li><a title="puppet和ansible比较" href="15038313193415.html">puppet和ansible比较</a></li>
          
            <li><a title="puppet学习笔记(二)" href="15038312823109.html">puppet学习笔记(二)</a></li>
          
            <li><a title="puppet学习笔记（一）" href="15038311899167.html">puppet学习笔记（一）</a></li>
          
            <li><a title="ssh大坑" href="15038309933322.html">ssh大坑</a></li>
          
            <li><a title="svn同步大坑" href="15038308908725.html">svn同步大坑</a></li>
          
            <li><a title="svn服务器搭建与迁移" href="15038308118838.html">svn服务器搭建与迁移</a></li>
          
            <li><a title="ubuntu mysql5.7源码安装" href="15033230940135.html">ubuntu mysql5.7源码安装</a></li>
          
            <li><a title="ubuntu php5.6源码安装" href="15033230316456.html">ubuntu php5.6源码安装</a></li>
          
            <li><a title="ubuntu下nginx的安裝" href="15033229668634.html">ubuntu下nginx的安裝</a></li>
          
            <li><a title="ubuntu安装php常见错误集锦" href="15033229497885.html">ubuntu安装php常见错误集锦</a></li>
          
            <li><a title="vim常用命令" href="15033229297218.html">vim常用命令</a></li>
          
            <li><a title="使用RAID进行磁盘管理" href="15033227857622.html">使用RAID进行磁盘管理</a></li>
          
            <li><a title="使用virt-manager创建和管理虚拟机" href="15033227559982.html">使用virt-manager创建和管理虚拟机</a></li>
          
            <li><a title="关于mysqld_safe" href="15033226078265.html">关于mysqld_safe</a></li>
          
            <li><a title="安装linux各种桌面环境" href="15033222846104.html">安装linux各种桌面环境</a></li>
          
            <li><a title="常用软件编译参数以及软件地址" href="15033222695994.html">常用软件编译参数以及软件地址</a></li>
          
            <li><a title="打造属于自己的vim利器" href="15033222443468.html">打造属于自己的vim利器</a></li>
          
            <li><a title="搭建本地yum源服务器" href="15033221654695.html">搭建本地yum源服务器</a></li>
          

      
        <li class="divider"></li>
        <li><label>http</label></li>

          
            <li><a title="HTTP协议 (七) Cookie" href="15038327056467.html">HTTP协议 (七) Cookie</a></li>
          
            <li><a title="HTTP协议 (六) 状态码详解" href="15038326831174.html">HTTP协议 (六) 状态码详解</a></li>
          
            <li><a title="HTTP协议 (五) 代理" href="15038326274764.html">HTTP协议 (五) 代理</a></li>
          
            <li><a title="HTTP协议 (四) 缓存" href="15038325535184.html">HTTP协议 (四) 缓存</a></li>
          
            <li><a title="HTTP协议 (三) 压缩" href="15038324866170.html">HTTP协议 (三) 压缩</a></li>
          
            <li><a title="HTTP协议 (二) 基本认证" href="15038324138209.html">HTTP协议 (二) 基本认证</a></li>
          
            <li><a title="HTTP协议 (一) HTTP协议详解" href="15038322654511.html">HTTP协议 (一) HTTP协议详解</a></li>
          

      
        <li class="divider"></li>
        <li><label>监控</label></li>

          
            <li><a title="zabbix安装排错过程" href="15033228802565.html">zabbix安装排错过程</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>容器</span></li>
                        
                          <li><a title="制作nginx和php的rpm包" href="15033225667618.html">制作nginx和php的rpm包</a></li>
                        

                    
                      <li class="side-title"><span>web服务器</span></li>
                        
                          <li><a title="图解正向代理、反向代理、透明代理" href="15033223691311.html">图解正向代理、反向代理、透明代理</a></li>
                        
                          <li><a title="详解apache的allow和deny" href="15033200332645.html">详解apache的allow和deny</a></li>
                        

                    
                      <li class="side-title"><span>卓越班学习</span></li>
                        
                          <li><a title="ELF和a.out文件格式的比较" href="15038328822812.html">ELF和a.out文件格式的比较</a></li>
                        
                          <li><a title="linux多线程编程入门" href="15038316827096.html">linux多线程编程入门</a></li>
                        
                          <li><a title="linux进程编程入门" href="15038316680304.html">linux进程编程入门</a></li>
                        
                          <li><a title="shell系统管理" href="15038311430982.html">shell系统管理</a></li>
                        
                          <li><a title="shell编程入门" href="15038311023811.html">shell编程入门</a></li>
                        
                          <li><a title="shell网络管理" href="15038310714574.html">shell网络管理</a></li>
                        
                          <li><a title="wait和waitpid详解" href="15033229130846.html">wait和waitpid详解</a></li>
                        
                          <li><a title="信号" href="15033227238921.html">信号</a></li>
                        
                          <li><a title="僵尸进程和孤儿进程" href="15033226512813.html">僵尸进程和孤儿进程</a></li>
                        
                          <li><a title="共享内存" href="15033226237472.html">共享内存</a></li>
                        
                          <li><a title="基于TCP的字符串传输程序" href="15033223148818.html">基于TCP的字符串传输程序</a></li>
                        
                          <li><a title="文件搜索" href="15033220404521.html">文件搜索</a></li>
                        
                          <li><a title="文件比较" href="15033218983068.html">文件比较</a></li>
                        
                          <li><a title="文件编辑" href="15033218793219.html">文件编辑</a></li>
                        
                          <li><a title="文件设置" href="15033218534320.html">文件设置</a></li>
                        
                          <li><a title="系统文件操作开发" href="15033218072587.html">系统文件操作开发</a></li>
                        
                          <li><a title="系统环境变量" href="15033217888989.html">系统环境变量</a></li>
                        
                          <li><a title="静态库和共享库开发" href="%E9%9D%99%E6%80%81%E5%BA%93%E5%92%8C%E5%85%B1%E4%BA%AB%E5%BA%93%E5%BC%80%E5%8F%91.html">静态库和共享库开发</a></li>
                        

                    
                      <li class="side-title"><span>坑</span></li>
                        
                          <li><a title="<center>数据库非正常关闭导致无法启动问题</center>" href="15033220957416.html"><center>数据库非正常关闭导致无法启动问题</center></a></li>
                        
                          <li><a title="解决virtualbox安装增强工具失败的问题" href="15033217564988.html">解决virtualbox安装增强工具失败的问题</a></li>
                        
                          <li><a title="记一次ftp服务器搭建走过的坑" href="15033217230950.html">记一次ftp服务器搭建走过的坑</a></li>
                        
                          <li><a title="记一次mysql主从一致校验走过的坑" href="15033215794872.html">记一次mysql主从一致校验走过的坑</a></li>
                        

                    
                      <li class="side-title"><span>日常运维</span></li>
                        
                          <li><a title="dns服务器报错解决" href="15038329582108.html">dns服务器报错解决</a></li>
                        
                          <li><a title="docker随谈" href="15038329005848.html">docker随谈</a></li>
                        
                          <li><a title="i节点，容易被人遗忘的节点" href="15038322315997.html">i节点，容易被人遗忘的节点</a></li>
                        
                          <li><a title="libc.so.6被删后导致系统无法使用的原因及解决方法" href="15038321032705.html">libc.so.6被删后导致系统无法使用的原因及解决方法</a></li>
                        
                          <li><a title="linux下nginx模块开发入门" href="15038318990451.html">linux下nginx模块开发入门</a></li>
                        
                          <li><a title="Linux下配置rsync服务器" href="15038318551859.html">Linux下配置rsync服务器</a></li>
                        
                          <li><a title="mysql初始化" href="15038316518471.html">mysql初始化</a></li>
                        
                          <li><a title="nagios安装" href="15038316187109.html">nagios安装</a></li>
                        
                          <li><a title="nagios配置" href="15038315676757.html">nagios配置</a></li>
                        
                          <li><a title="nginx、mysql、php等各编译参数查询" href="15038315492978.html">nginx、mysql、php等各编译参数查询</a></li>
                        
                          <li><a title="nginx性能优化技巧" href="15038314081873.html">nginx性能优化技巧</a></li>
                        
                          <li><a title="php安装memcache扩展" href="15038313472966.html">php安装memcache扩展</a></li>
                        
                          <li><a title="puppet和ansible比较" href="15038313193415.html">puppet和ansible比较</a></li>
                        
                          <li><a title="puppet学习笔记(二)" href="15038312823109.html">puppet学习笔记(二)</a></li>
                        
                          <li><a title="puppet学习笔记（一）" href="15038311899167.html">puppet学习笔记（一）</a></li>
                        
                          <li><a title="ssh大坑" href="15038309933322.html">ssh大坑</a></li>
                        
                          <li><a title="svn同步大坑" href="15038308908725.html">svn同步大坑</a></li>
                        
                          <li><a title="svn服务器搭建与迁移" href="15038308118838.html">svn服务器搭建与迁移</a></li>
                        
                          <li><a title="ubuntu mysql5.7源码安装" href="15033230940135.html">ubuntu mysql5.7源码安装</a></li>
                        
                          <li><a title="ubuntu php5.6源码安装" href="15033230316456.html">ubuntu php5.6源码安装</a></li>
                        
                          <li><a title="ubuntu下nginx的安裝" href="15033229668634.html">ubuntu下nginx的安裝</a></li>
                        
                          <li><a title="ubuntu安装php常见错误集锦" href="15033229497885.html">ubuntu安装php常见错误集锦</a></li>
                        
                          <li><a title="vim常用命令" href="15033229297218.html">vim常用命令</a></li>
                        
                          <li><a title="使用RAID进行磁盘管理" href="15033227857622.html">使用RAID进行磁盘管理</a></li>
                        
                          <li><a title="使用virt-manager创建和管理虚拟机" href="15033227559982.html">使用virt-manager创建和管理虚拟机</a></li>
                        
                          <li><a title="关于mysqld_safe" href="15033226078265.html">关于mysqld_safe</a></li>
                        
                          <li><a title="安装linux各种桌面环境" href="15033222846104.html">安装linux各种桌面环境</a></li>
                        
                          <li><a title="常用软件编译参数以及软件地址" href="15033222695994.html">常用软件编译参数以及软件地址</a></li>
                        
                          <li><a title="打造属于自己的vim利器" href="15033222443468.html">打造属于自己的vim利器</a></li>
                        
                          <li><a title="搭建本地yum源服务器" href="15033221654695.html">搭建本地yum源服务器</a></li>
                        

                    
                      <li class="side-title"><span>http</span></li>
                        
                          <li><a title="HTTP协议 (七) Cookie" href="15038327056467.html">HTTP协议 (七) Cookie</a></li>
                        
                          <li><a title="HTTP协议 (六) 状态码详解" href="15038326831174.html">HTTP协议 (六) 状态码详解</a></li>
                        
                          <li><a title="HTTP协议 (五) 代理" href="15038326274764.html">HTTP协议 (五) 代理</a></li>
                        
                          <li><a title="HTTP协议 (四) 缓存" href="15038325535184.html">HTTP协议 (四) 缓存</a></li>
                        
                          <li><a title="HTTP协议 (三) 压缩" href="15038324866170.html">HTTP协议 (三) 压缩</a></li>
                        
                          <li><a title="HTTP协议 (二) 基本认证" href="15038324138209.html">HTTP协议 (二) 基本认证</a></li>
                        
                          <li><a title="HTTP协议 (一) HTTP协议详解" href="15038322654511.html">HTTP协议 (一) HTTP协议详解</a></li>
                        

                    
                      <li class="side-title"><span>监控</span></li>
                        
                          <li><a title="zabbix安装排错过程" href="15033228802565.html">zabbix安装排错过程</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 


	
		<div class="markdown-body">
		<h1>系统文件操作开发</h1>

		<h4 id="toc_0">1.系统文件读写</h4>

<p>任务描述:</p>

<ul>
<li>编写程序,读取linux系统文件&quot;/etc/passwd&quot;内容,并输出到屏幕上.同时在程序目录新建文件passwd,将&quot;/etc/passwd&quot;系统文件内容复制到新建的passwd中</li>
</ul>

<p>main.c:</p>

<blockquote>
<pre><code>#include&lt;stdio.h&gt;
#include&lt;unistd.h&gt;
#include&lt;stdlib.h&gt;
#include&lt;sys/types.h&gt;
#include&lt;sys/stat.h&gt;
#include&lt;fcntl.h&gt;
#define N 1000
int main(void){
    int fp1,fp2,num;
    char *file1,*file2;
    char buf[N];
    file1=&quot;/etc/passwd&quot;;
    file2=&quot;passwd&quot;;
    if(( fp1=open(file1,O_RDONLY))==-1){            
        printf(&quot;can&#39;t open %s\n&quot;,file1);
        return 1;
    }
    if((fp2=open(file2,O_CREAT|O_WRONLY))==-1){
        printf(&quot;can&#39;t create %s\n&quot;,file2);
        return -1;
    }
    while((num = read(fp1,buf,N))&gt;0){
        printf(&quot;%s\n&quot;,buf);
        if(write(fp2,buf,num) == -1 ){
            printf(&quot;can&#39;t write to %s\n&quot;,file2);
            return -1;
        }
    }   
    close(fp1);close(fp2);
    return 0; 
}
</code></pre>
</blockquote>

<h4 id="toc_1">2.文件内容统计操作</h4>

<p>任务描述:</p>

<ul>
<li>给定系统文件filesystem.manifest(dpkg-query -W --showformat=&#39;${Package} ${Version}\n&#39;&gt;filesystem.manifest)</li>
<li>目前文件每一行格式为&quot;软件包名 版本号&quot;,要求输出每一行的格式为&quot;软件包名&quot;(去除版本号相关信息)到文件filesystem.manifest.name</li>
<li>在第一步基础上,进一步去除换行符号,使整个文件的输出为一行(不同包名用空格分割),格式为&quot;软件包1 软件包2 软件包3...&quot;,输出到文件filesystem.manifest.name.oneline</li>
<li>目前每一行格式为&quot;软件包名 版本号&quot;,找到文件中软件包名有&quot;ubuntu&quot;字样的软件包,并直接输出其个数(不能人工查找,需直接输出其个数)</li>
</ul>

<p>相关知识：<br/>
①cut <br/>
　　从一个文本文件或者文本流中提取文本列<br/>
命令用法:<br/>
　　cut -b list [-n] [file ...]<br/>
　　cut -c list [file ...]<br/>
　　cut -f list [-d delim][-s][file ...]<br/>
　　上面的-b、-c、-f 分别表示字节、字符、字段(即 byte、character、field);<br/>
　　list 表示-b、-c、-f 操作范围,-n 常常表示具体数字;<br/>
　　file 表示的自然是要操作的文本文件的名称;<br/>
　　delim(英文全写:delimiter)表示分隔符,默认情况下为 TAB;<br/>
　　-s 表示不包括那些不含分隔符的行(这样有利于去掉注释和标题)<br/>
　　上面三种方式中,表示从指定的范围中提取字节(-b)、或字符(-c)、或字段(-f)。<br/>
②xargs <br/>
　　将参数列表转换成小块分段传递给其他命令,以避免参数列表过长的问题<br/>
　　例如,下面的命令:<br/>
　　rm `find /path -type f`如果 path 目录下文件过多就会因为“参数列表过长”而报错无法执行。但改用 xargs 以后,问题即获解决。<br/>
　　find /path -type f -print0 | xargs -0 rm<br/>
　　本例中 xargs 将 find 产生的长串文件列表拆散成多个子串,然后对每个子串调用 rm。这样要比如下使用 find 命令效率高的多。<br/>
　　find /path -type f -exec rm &#39;{}&#39; \;<br/>
　　上面这条命令会对每个文件调用&quot;rm&quot;命令。当然使用新版的&quot;find&quot;也可以得到和&quot;xargs&quot;命令同样的效果:find /path -type f -exec rm &#39;{}&#39; +<br/>
　　xargs 的作用一般等同于大多数 Unix shell 中的反引号,但更加灵活易用,并可以正确处理输入中有空格等特殊字符的情况。对于经常产生大量输出的命令如 find、locate 和 grep 来说非常有用。</p>

<blockquote>
<pre><code>#!/bin/bash
dpkg-query -W --showformat=&#39;${Package} ${Version}\n&#39;&gt;filesystem.manifest
cat filesystem.manifest|cut -d &#39; &#39; -f 1 &gt;filesystem.manifest.name
cat filesystem.manifest.name|xargs &gt;filesystem.manifest.name.oneline
cat filesystem.manifest|grep &quot;ubuntu&quot;|wc -l
#-d &#39; &#39;表示以空格为字符 -f 1表示输出第一列
#xargs表示将参数列表转换成小块分段传递给其他命令,以避免参数列表过长的问题
</code></pre>
</blockquote>

<h4 id="toc_2">3.文件描述符获取</h4>

<p>任务描述：</p>

<ul>
<li>打印输入设备，输出设备，标准错误输出设备的文件描述符</li>
<li>任意打开一个存在文件a，打印其文件描述符</li>
<li>不关闭文件a,定义新的文件描述符重新打开a,打印其文件描述符</li>
<li>关闭文件a,定义新的文件描述符重新打开a,打印文件描述符</li>
</ul>

<p>相关知识:<br/>
　　任何打开的文件都将被分配一个唯一标识该打开文件的文件描述符,为一个大于等于 0的整数。系统启动后,默认打开的文件流有标准输入设备(STDIN)、标准输出设备(STDOUT)和标准错误输出设备(STDERR),其文件描述符分别为 0、1、2。以后打开的文件的文件描述符分配依次增加。使用 fileno()函数可以返回一个流对应的文件描述符。<br/>
main.c:</p>

<blockquote>
<pre><code>#include &lt;stdio.h&gt;
int main(){
    FILE *fp1,*fp2,*fp3,*fp4;
    int fd;
    fd=fileno(stdin);
    printf(&quot;stdin is :%d\n&quot;,fd);
    fd=fileno(stdout);
    printf(&quot;stdout is :%d\n&quot;,fd);
    fd=fileno(stderr);
    printf(&quot;stderr is :%d\n&quot;,fd);
    printf(&quot;open file and open again before it closed\n&quot;);
    fp1=fopen(&quot;test.c&quot;, &quot;r&quot;);
    fd=fileno(fp1);
    printf(&quot;main.c is %d\n&quot;, fd);
    fp2=fopen(&quot;test.c&quot;,&quot;r&quot;);
    fd=fileno(fp2);
    printf(&quot;main.c is %d\n&quot;,fd);
    fclose(fp1);fclose(fp2);
    printf(&quot;open file and open again after it closed\n&quot;);
    fp3=fopen(&quot;test.c&quot;,&quot;r&quot;);
    fd=fileno(fp3);
    printf(&quot;main.c is %d\n&quot;,fd);
    fclose(fp3);
    fp4=fopen(&quot;test.c&quot;,&quot;r&quot;);
    fd=fileno(fp4);
    printf(&quot;main.c is %d\n&quot;,fd);
    return 0;
}
</code></pre>
</blockquote>

<h4 id="toc_3">4.检测文件读写权限</h4>

<p>任务描述:</p>

<ul>
<li>检测文件当前读写权限,如果文件具有读权限,则打印可读信息,如果有写权限,则打印可写信息,否则返回错误信息</li>
<li>用fcntl函数实现</li>
</ul>

<p>相关知识:<br/>
fcntl <br/>
功能描述:根据文件描述词来操作文件的特性。<br/>
文件控制函数:fcntl -- file control<br/>
函数原型:</p>

<blockquote>
<pre><code>#include &lt;fcntl.h&gt;;
int fcntl(int fd, int cmd);
int fcntl(int fd, int cmd, long arg);
int fcntl(int fd, int cmd, struct flock *lock);
</code></pre>
</blockquote>

<p>描述: fcntl()针对(文件)描述符提供控制.参数 fd 是被参数 cmd 操作(如下面的描述)的描述符。针对 cmd 的值,fcntl 能够接受第三个参数 int arg。<br/>
fcntl 函数有 5 种功能:<br/>
1.复制一个现有的描述符(cmd=F_DUPFD).<br/>
2.获得/设置文件描述符标记(cmd=F_GETFD 或 F_SETFD).<br/>
3.获得/设置文件状态标记(cmd=F_GETFL 或 F_SETFL).<br/>
4.获得/设置异步 I/O 所有权(cmd=F_GETOWN 或 F_SETOWN).5.获得/设置记录锁(cmd=F_GETLK,F_SETLK 或 F_SETLKW).</p>

<p>main.c:</p>

<blockquote>
<pre><code>#include&lt;stdio.h&gt;
#include&lt;fcntl.h&gt;
int main(void){ 
    FILE *fp;  
    int val,acc,a;
    if(( fp=fopen(&quot;test.c&quot;,&quot;r+&quot;)) == NULL){  
        printf(&quot;can&#39;t open the file\n&quot;);
        return 1;
    }
    a=fileno(fp);
    val=fcntl(a,F_GETFL,0);//获得文件状态标记
    acc=val&amp;O_ACCMODE;//把不是关于r、w、x的文件状态标记屏蔽掉
    if (acc==O_RDONLY)
        printf(&quot;read only\n&quot;);
    if (acc==O_WRONLY)
        printf(&quot;write only\n&quot;);
    if (acc==O_RDWR)
        printf(&quot;read write\n&quot;);
    fclose(fp);
    return 0;
}
</code></pre>
</blockquote>

<h4 id="toc_4">5.锁定/解锁文件</h4>

<p>任务描述:</p>

<ul>
<li>用fcntl函数实现锁定文件test_lock的两个区域,锁定类型均为以文件开头为锁定的起始位置,区域1锁定为供读取用,起始偏移量为10,长度为20;区域2锁定为供写入用,起始偏移量为40,长度为10.</li>
<li>当进程锁定文件指定区域时,输出&quot;process locking file&quot;,停顿10秒钟,关闭文件描述符,输出&quot;process closing file&quot;</li>
<li>使用flock数据结构,使用fcntl函数</li>
</ul>

<p>相关知识:<br/>
　　Linux 支持的文件锁技术主要包括劝告锁(advisory lock)和强制锁(mandatory lock)这两种。此外,Linux 中还引入了两种强制锁的变种形式:共享模式强制锁(share-mode mandatory lock)和租借锁(lease)。<br/>
　　在 Linux 中,不论进程是在使用劝告锁还是强制锁,它都可以同时使用共享锁和排他锁(又称为读锁和写锁)。多个共享锁之间不会相互干扰,多个进程在同一时刻可以对同一个文件加共享锁。但是,如果一个进程对该文件加了排他锁,那么其他进程则无权再对该文件加共享锁或者排他锁,直到该排他锁被释放。所以,对于同一个文件来说,它可以同时拥有很多读者,但是在某一特定时刻,它只能拥有一个写者<br/>
　　flock 函数用于实现对文件的锁定和解锁操作。此函数只能锁定整个文件,不能锁定某个区域。要锁定某个区域,则需要使用 fcntl()函数。</p>

<blockquote>
<pre><code>int fcntl(int fd, int cmd, struct flock *lock);参数lock指针为flock 结构指针，定义如下:
struct flock{
    short int l_type;
    short int l_whence;
    off_t l_start;
    off_t l_len;
    pid_t l_pid;
};
</code></pre>

<p>　　l_type 有三种状态:<br/>
　　　　F_RDLCK 建立一个供读取用的锁定<br/>
　　　　F_WRLCK 建立一个供写入用的锁定<br/>
　　　　F_UNLCK 删除之前建立的锁定<br/>
　　l_whence 也有三种方式:<br/>
　　　　SEEK_SET 以文件开头为锁定的起始位置。<br/>
　　　　SEEK_CUR 以目前文件读写位置为锁定的起始位置<br/>
　　　　SEEK_END 以文件结尾为锁定的起始位置。<br/>
　　l_start 表示相对l_whence位置的偏移量，两者一起确定锁定区域的开始位置。<br/>
　　l_len表示锁定区域的长度，若果为0表示从起点(由l_whence和 l_start决定的开始位置)开始直到最大可能偏移量为止。即不管在后面增加多少数据都在锁的范围内。</p>
</blockquote>

<p>main.c:</p>

<blockquote>
<pre><code>#include&lt;stdio.h&gt;
#include&lt;fcntl.h&gt;
int main(void){
    int re,fd;
    fd=open(&quot;test_lock&quot;,O_RDWR|O_CREAT,0644);
    struct flock z1;
    z1.l_type=F_RDLCK;//建立一个供读取用的锁定
    z1.l_whence=SEEK_SET;//以文件开头为锁定的起始位置
    z1.l_start=10;
    z1.l_len=20;
    printf(&quot;Process %d locking file\n&quot;,getpid());
    if((re=fcntl(fd,F_SETLK,&amp;z1))==-1){
        printf(&quot;failed to lock z1&quot;);
    }
    struct flock z2;
    z2.l_type=F_WRLCK;//建立一个供写入用的锁定
    z2.l_whence=SEEK_SET;//以文件开头为锁定的起始位置
    z2.l_start=40;
    z2.l_len=10;
    if((re=fcntl(fd,F_SETLK,&amp;z2))==-1){
        printf(&quot;failed to lock z2&quot;);
    }
    sleep( 10);
    printf(&quot;Process %d closing file\n&quot;,getpid());
    close(fd);
    return 0;
}
</code></pre>
</blockquote>

<h4 id="toc_5">6.使用 chmod()函数修改文件权限</h4>

<p>任务描述:</p>

<ul>
<li>首先使用touch命令新建3个临时文件:test1,test2,test3</li>
<li>查看最原始文件权限情况(是否为拥有者可读写,所有其他人可读)</li>
<li>设置test1为拥有者可读写,同组用户可读写,其他人可读;test2为拥有者可读写,同组用户可读写可执行,其他人可读;test3为拥有者可读写,同组用户可写不可读、其他用户可写不可读</li>
<li>采用stat数据结,chmod函数</li>
<li>输出修改权限前和修改权限后的文件属性</li>
</ul>

<p>相关知识:<br/>
文件权限知识:<br/>
　　Linux 系统中的每个文件和目录都有访问许可权限,用它来确定谁可以通过何种方式对文件和目录进行访问和操作。<br/>
　　文件或目录的访问权限分为只读,只写和可执行三种。以文件为例,只读权限表示只允许读其内容,而禁止对其做任何的更改操作。可执行权限表示允许将该文件作为一个程序执行。文件被创建时,文件所有者自动拥有对该文件的读、写和可执行权限,以便于对文件的阅读和修改。用户也可根据需要把访问权限设置为需要的任何组合。有三种不同类型的用户可对文件或目录进行访问:文件所有者,同组用户、其他用户。<br/>
　　所有者一般是文件的创建者。所有者可以允许同组用户有权访问文件,还可以将文件的访问权限赋予系统中的其他用户。在这种情况下,系统中每一位用户都能访问该用户拥有的文件或目录。<br/>
　　每一文件或目录的访问权限都有三组,每组用三位表示,分别为文件属主的读、写和执行权限;与属主同组的用户的读、写和执行权限;系统中其他用户的读、写和执行权限。当用 ls -l 命令显示文件或目录的详细信息时,最左边的一列为文件的访问权限。</p>

<p>main.c:</p>

<blockquote>
<pre><code>#include&lt;stdio.h&gt;
#include&lt;sys/stat.h&gt;
#include&lt;unistd.h&gt;
int main(void){
    chmod(&quot;test01&quot;,S_IRUSR|S_IWUSR|S_IRGRP|S_IWGRP|S_IROTH);
    chmod(&quot;test02&quot;,S_IRUSR|S_IWUSR|S_IRGRP|S_IWGRP|S_IXGRP|S_IROTH);
    chmod(&quot;test03&quot;,S_IRUSR|S_IWUSR|S_IWGRP|S_IWOTH);
    return 0;
}
</code></pre>
</blockquote>


		</div>
	

 
	

 
	

  
  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    <script src="asset/chart/all-min.js"></script><script type="text/javascript">$(function(){    var mwebii=0;    var mwebChartEleId = 'mweb-chart-ele-';    $('pre>code').each(function(){        mwebii++;        var eleiid = mwebChartEleId+mwebii;        if($(this).hasClass('language-sequence')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = Diagram.parse($(this).text());            diagram.drawSVG(eleiid,{theme: 'simple'});        }else if($(this).hasClass('language-flow')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = flowchart.parse($(this).text());            diagram.drawSVG(eleiid);        }    });});</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>

  </body>
</html>
