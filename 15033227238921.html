<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  信号 - 小菜鸡
  
  </title>
 <meta name="description" content="个人博客">
 <link href="atom.xml" rel="alternate" title="小菜鸡" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">小菜鸡</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; 小菜鸡</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>容器</label></li>

          
            <li><a title="制作nginx和php的rpm包" href="15033225667618.html">制作nginx和php的rpm包</a></li>
          

      
        <li class="divider"></li>
        <li><label>web服务器</label></li>

          
            <li><a title="图解正向代理、反向代理、透明代理" href="15033223691311.html">图解正向代理、反向代理、透明代理</a></li>
          
            <li><a title="详解apache的allow和deny" href="15033200332645.html">详解apache的allow和deny</a></li>
          

      
        <li class="divider"></li>
        <li><label>卓越班学习</label></li>

          
            <li><a title="ELF和a.out文件格式的比较" href="15038328822812.html">ELF和a.out文件格式的比较</a></li>
          
            <li><a title="linux多线程编程入门" href="15038316827096.html">linux多线程编程入门</a></li>
          
            <li><a title="linux进程编程入门" href="15038316680304.html">linux进程编程入门</a></li>
          
            <li><a title="shell系统管理" href="15038311430982.html">shell系统管理</a></li>
          
            <li><a title="shell编程入门" href="15038311023811.html">shell编程入门</a></li>
          
            <li><a title="shell网络管理" href="15038310714574.html">shell网络管理</a></li>
          
            <li><a title="wait和waitpid详解" href="15033229130846.html">wait和waitpid详解</a></li>
          
            <li><a title="信号" href="15033227238921.html">信号</a></li>
          
            <li><a title="僵尸进程和孤儿进程" href="15033226512813.html">僵尸进程和孤儿进程</a></li>
          
            <li><a title="共享内存" href="15033226237472.html">共享内存</a></li>
          
            <li><a title="基于TCP的字符串传输程序" href="15033223148818.html">基于TCP的字符串传输程序</a></li>
          
            <li><a title="文件搜索" href="15033220404521.html">文件搜索</a></li>
          
            <li><a title="文件比较" href="15033218983068.html">文件比较</a></li>
          
            <li><a title="文件编辑" href="15033218793219.html">文件编辑</a></li>
          
            <li><a title="文件设置" href="15033218534320.html">文件设置</a></li>
          
            <li><a title="系统文件操作开发" href="15033218072587.html">系统文件操作开发</a></li>
          
            <li><a title="系统环境变量" href="15033217888989.html">系统环境变量</a></li>
          
            <li><a title="静态库和共享库开发" href="%E9%9D%99%E6%80%81%E5%BA%93%E5%92%8C%E5%85%B1%E4%BA%AB%E5%BA%93%E5%BC%80%E5%8F%91.html">静态库和共享库开发</a></li>
          

      
        <li class="divider"></li>
        <li><label>坑</label></li>

          
            <li><a title="<center>数据库非正常关闭导致无法启动问题</center>" href="15033220957416.html"><center>数据库非正常关闭导致无法启动问题</center></a></li>
          
            <li><a title="解决virtualbox安装增强工具失败的问题" href="15033217564988.html">解决virtualbox安装增强工具失败的问题</a></li>
          
            <li><a title="记一次ftp服务器搭建走过的坑" href="15033217230950.html">记一次ftp服务器搭建走过的坑</a></li>
          
            <li><a title="记一次mysql主从一致校验走过的坑" href="15033215794872.html">记一次mysql主从一致校验走过的坑</a></li>
          

      
        <li class="divider"></li>
        <li><label>日常运维</label></li>

          
            <li><a title="dns服务器报错解决" href="15038329582108.html">dns服务器报错解决</a></li>
          
            <li><a title="docker随谈" href="15038329005848.html">docker随谈</a></li>
          
            <li><a title="i节点，容易被人遗忘的节点" href="15038322315997.html">i节点，容易被人遗忘的节点</a></li>
          
            <li><a title="libc.so.6被删后导致系统无法使用的原因及解决方法" href="15038321032705.html">libc.so.6被删后导致系统无法使用的原因及解决方法</a></li>
          
            <li><a title="linux下nginx模块开发入门" href="15038318990451.html">linux下nginx模块开发入门</a></li>
          
            <li><a title="Linux下配置rsync服务器" href="15038318551859.html">Linux下配置rsync服务器</a></li>
          
            <li><a title="mysql初始化" href="15038316518471.html">mysql初始化</a></li>
          
            <li><a title="nagios安装" href="15038316187109.html">nagios安装</a></li>
          
            <li><a title="nagios配置" href="15038315676757.html">nagios配置</a></li>
          
            <li><a title="nginx、mysql、php等各编译参数查询" href="15038315492978.html">nginx、mysql、php等各编译参数查询</a></li>
          
            <li><a title="nginx性能优化技巧" href="15038314081873.html">nginx性能优化技巧</a></li>
          
            <li><a title="php安装memcache扩展" href="15038313472966.html">php安装memcache扩展</a></li>
          
            <li><a title="puppet和ansible比较" href="15038313193415.html">puppet和ansible比较</a></li>
          
            <li><a title="puppet学习笔记(二)" href="15038312823109.html">puppet学习笔记(二)</a></li>
          
            <li><a title="puppet学习笔记（一）" href="15038311899167.html">puppet学习笔记（一）</a></li>
          
            <li><a title="ssh大坑" href="15038309933322.html">ssh大坑</a></li>
          
            <li><a title="svn同步大坑" href="15038308908725.html">svn同步大坑</a></li>
          
            <li><a title="svn服务器搭建与迁移" href="15038308118838.html">svn服务器搭建与迁移</a></li>
          
            <li><a title="ubuntu mysql5.7源码安装" href="15033230940135.html">ubuntu mysql5.7源码安装</a></li>
          
            <li><a title="ubuntu php5.6源码安装" href="15033230316456.html">ubuntu php5.6源码安装</a></li>
          
            <li><a title="ubuntu下nginx的安裝" href="15033229668634.html">ubuntu下nginx的安裝</a></li>
          
            <li><a title="ubuntu安装php常见错误集锦" href="15033229497885.html">ubuntu安装php常见错误集锦</a></li>
          
            <li><a title="vim常用命令" href="15033229297218.html">vim常用命令</a></li>
          
            <li><a title="使用RAID进行磁盘管理" href="15033227857622.html">使用RAID进行磁盘管理</a></li>
          
            <li><a title="使用virt-manager创建和管理虚拟机" href="15033227559982.html">使用virt-manager创建和管理虚拟机</a></li>
          
            <li><a title="关于mysqld_safe" href="15033226078265.html">关于mysqld_safe</a></li>
          
            <li><a title="安装linux各种桌面环境" href="15033222846104.html">安装linux各种桌面环境</a></li>
          
            <li><a title="常用软件编译参数以及软件地址" href="15033222695994.html">常用软件编译参数以及软件地址</a></li>
          
            <li><a title="打造属于自己的vim利器" href="15033222443468.html">打造属于自己的vim利器</a></li>
          
            <li><a title="搭建本地yum源服务器" href="15033221654695.html">搭建本地yum源服务器</a></li>
          

      
        <li class="divider"></li>
        <li><label>http</label></li>

          
            <li><a title="HTTP协议 (七) Cookie" href="15038327056467.html">HTTP协议 (七) Cookie</a></li>
          
            <li><a title="HTTP协议 (六) 状态码详解" href="15038326831174.html">HTTP协议 (六) 状态码详解</a></li>
          
            <li><a title="HTTP协议 (五) 代理" href="15038326274764.html">HTTP协议 (五) 代理</a></li>
          
            <li><a title="HTTP协议 (四) 缓存" href="15038325535184.html">HTTP协议 (四) 缓存</a></li>
          
            <li><a title="HTTP协议 (三) 压缩" href="15038324866170.html">HTTP协议 (三) 压缩</a></li>
          
            <li><a title="HTTP协议 (二) 基本认证" href="15038324138209.html">HTTP协议 (二) 基本认证</a></li>
          
            <li><a title="HTTP协议 (一) HTTP协议详解" href="15038322654511.html">HTTP协议 (一) HTTP协议详解</a></li>
          

      
        <li class="divider"></li>
        <li><label>监控</label></li>

          
            <li><a title="zabbix安装排错过程" href="15033228802565.html">zabbix安装排错过程</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>容器</span></li>
                        
                          <li><a title="制作nginx和php的rpm包" href="15033225667618.html">制作nginx和php的rpm包</a></li>
                        

                    
                      <li class="side-title"><span>web服务器</span></li>
                        
                          <li><a title="图解正向代理、反向代理、透明代理" href="15033223691311.html">图解正向代理、反向代理、透明代理</a></li>
                        
                          <li><a title="详解apache的allow和deny" href="15033200332645.html">详解apache的allow和deny</a></li>
                        

                    
                      <li class="side-title"><span>卓越班学习</span></li>
                        
                          <li><a title="ELF和a.out文件格式的比较" href="15038328822812.html">ELF和a.out文件格式的比较</a></li>
                        
                          <li><a title="linux多线程编程入门" href="15038316827096.html">linux多线程编程入门</a></li>
                        
                          <li><a title="linux进程编程入门" href="15038316680304.html">linux进程编程入门</a></li>
                        
                          <li><a title="shell系统管理" href="15038311430982.html">shell系统管理</a></li>
                        
                          <li><a title="shell编程入门" href="15038311023811.html">shell编程入门</a></li>
                        
                          <li><a title="shell网络管理" href="15038310714574.html">shell网络管理</a></li>
                        
                          <li><a title="wait和waitpid详解" href="15033229130846.html">wait和waitpid详解</a></li>
                        
                          <li><a title="信号" href="15033227238921.html">信号</a></li>
                        
                          <li><a title="僵尸进程和孤儿进程" href="15033226512813.html">僵尸进程和孤儿进程</a></li>
                        
                          <li><a title="共享内存" href="15033226237472.html">共享内存</a></li>
                        
                          <li><a title="基于TCP的字符串传输程序" href="15033223148818.html">基于TCP的字符串传输程序</a></li>
                        
                          <li><a title="文件搜索" href="15033220404521.html">文件搜索</a></li>
                        
                          <li><a title="文件比较" href="15033218983068.html">文件比较</a></li>
                        
                          <li><a title="文件编辑" href="15033218793219.html">文件编辑</a></li>
                        
                          <li><a title="文件设置" href="15033218534320.html">文件设置</a></li>
                        
                          <li><a title="系统文件操作开发" href="15033218072587.html">系统文件操作开发</a></li>
                        
                          <li><a title="系统环境变量" href="15033217888989.html">系统环境变量</a></li>
                        
                          <li><a title="静态库和共享库开发" href="%E9%9D%99%E6%80%81%E5%BA%93%E5%92%8C%E5%85%B1%E4%BA%AB%E5%BA%93%E5%BC%80%E5%8F%91.html">静态库和共享库开发</a></li>
                        

                    
                      <li class="side-title"><span>坑</span></li>
                        
                          <li><a title="<center>数据库非正常关闭导致无法启动问题</center>" href="15033220957416.html"><center>数据库非正常关闭导致无法启动问题</center></a></li>
                        
                          <li><a title="解决virtualbox安装增强工具失败的问题" href="15033217564988.html">解决virtualbox安装增强工具失败的问题</a></li>
                        
                          <li><a title="记一次ftp服务器搭建走过的坑" href="15033217230950.html">记一次ftp服务器搭建走过的坑</a></li>
                        
                          <li><a title="记一次mysql主从一致校验走过的坑" href="15033215794872.html">记一次mysql主从一致校验走过的坑</a></li>
                        

                    
                      <li class="side-title"><span>日常运维</span></li>
                        
                          <li><a title="dns服务器报错解决" href="15038329582108.html">dns服务器报错解决</a></li>
                        
                          <li><a title="docker随谈" href="15038329005848.html">docker随谈</a></li>
                        
                          <li><a title="i节点，容易被人遗忘的节点" href="15038322315997.html">i节点，容易被人遗忘的节点</a></li>
                        
                          <li><a title="libc.so.6被删后导致系统无法使用的原因及解决方法" href="15038321032705.html">libc.so.6被删后导致系统无法使用的原因及解决方法</a></li>
                        
                          <li><a title="linux下nginx模块开发入门" href="15038318990451.html">linux下nginx模块开发入门</a></li>
                        
                          <li><a title="Linux下配置rsync服务器" href="15038318551859.html">Linux下配置rsync服务器</a></li>
                        
                          <li><a title="mysql初始化" href="15038316518471.html">mysql初始化</a></li>
                        
                          <li><a title="nagios安装" href="15038316187109.html">nagios安装</a></li>
                        
                          <li><a title="nagios配置" href="15038315676757.html">nagios配置</a></li>
                        
                          <li><a title="nginx、mysql、php等各编译参数查询" href="15038315492978.html">nginx、mysql、php等各编译参数查询</a></li>
                        
                          <li><a title="nginx性能优化技巧" href="15038314081873.html">nginx性能优化技巧</a></li>
                        
                          <li><a title="php安装memcache扩展" href="15038313472966.html">php安装memcache扩展</a></li>
                        
                          <li><a title="puppet和ansible比较" href="15038313193415.html">puppet和ansible比较</a></li>
                        
                          <li><a title="puppet学习笔记(二)" href="15038312823109.html">puppet学习笔记(二)</a></li>
                        
                          <li><a title="puppet学习笔记（一）" href="15038311899167.html">puppet学习笔记（一）</a></li>
                        
                          <li><a title="ssh大坑" href="15038309933322.html">ssh大坑</a></li>
                        
                          <li><a title="svn同步大坑" href="15038308908725.html">svn同步大坑</a></li>
                        
                          <li><a title="svn服务器搭建与迁移" href="15038308118838.html">svn服务器搭建与迁移</a></li>
                        
                          <li><a title="ubuntu mysql5.7源码安装" href="15033230940135.html">ubuntu mysql5.7源码安装</a></li>
                        
                          <li><a title="ubuntu php5.6源码安装" href="15033230316456.html">ubuntu php5.6源码安装</a></li>
                        
                          <li><a title="ubuntu下nginx的安裝" href="15033229668634.html">ubuntu下nginx的安裝</a></li>
                        
                          <li><a title="ubuntu安装php常见错误集锦" href="15033229497885.html">ubuntu安装php常见错误集锦</a></li>
                        
                          <li><a title="vim常用命令" href="15033229297218.html">vim常用命令</a></li>
                        
                          <li><a title="使用RAID进行磁盘管理" href="15033227857622.html">使用RAID进行磁盘管理</a></li>
                        
                          <li><a title="使用virt-manager创建和管理虚拟机" href="15033227559982.html">使用virt-manager创建和管理虚拟机</a></li>
                        
                          <li><a title="关于mysqld_safe" href="15033226078265.html">关于mysqld_safe</a></li>
                        
                          <li><a title="安装linux各种桌面环境" href="15033222846104.html">安装linux各种桌面环境</a></li>
                        
                          <li><a title="常用软件编译参数以及软件地址" href="15033222695994.html">常用软件编译参数以及软件地址</a></li>
                        
                          <li><a title="打造属于自己的vim利器" href="15033222443468.html">打造属于自己的vim利器</a></li>
                        
                          <li><a title="搭建本地yum源服务器" href="15033221654695.html">搭建本地yum源服务器</a></li>
                        

                    
                      <li class="side-title"><span>http</span></li>
                        
                          <li><a title="HTTP协议 (七) Cookie" href="15038327056467.html">HTTP协议 (七) Cookie</a></li>
                        
                          <li><a title="HTTP协议 (六) 状态码详解" href="15038326831174.html">HTTP协议 (六) 状态码详解</a></li>
                        
                          <li><a title="HTTP协议 (五) 代理" href="15038326274764.html">HTTP协议 (五) 代理</a></li>
                        
                          <li><a title="HTTP协议 (四) 缓存" href="15038325535184.html">HTTP协议 (四) 缓存</a></li>
                        
                          <li><a title="HTTP协议 (三) 压缩" href="15038324866170.html">HTTP协议 (三) 压缩</a></li>
                        
                          <li><a title="HTTP协议 (二) 基本认证" href="15038324138209.html">HTTP协议 (二) 基本认证</a></li>
                        
                          <li><a title="HTTP协议 (一) HTTP协议详解" href="15038322654511.html">HTTP协议 (一) HTTP协议详解</a></li>
                        

                    
                      <li class="side-title"><span>监控</span></li>
                        
                          <li><a title="zabbix安装排错过程" href="15033228802565.html">zabbix安装排错过程</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 <div class="markdown-body">
<h1>信号</h1>

<h3 id="toc_0">背景知识：</h3>

<p>　　信号机制是进程之间相互传递消息的一种方法，信号全称为软中断信号，也有人称作软中断。从它的命名可以看出，它的实质和使用很象中断。所以，信号可以说是进程控制的一部分。 <br/>
　　软中断信号（signal，又简称为信号）用来通知进程发生了异步事件。进程之间可以互相通过系统调用kill发送软中断信号。内核也可以因为内部事件而给进程发送信号，通知进程发生了某个事件。注意，信号只是用来通知某进程发生了什么事件，并不给该进程传递任何数据。 <br/>
　　收到信号的进程对各种信号有不同的处理方法。处理方法可以分为三类：第一种是类似中断的处理程序，对于需要处理的信号，进程可以指定处理函数，由该函数来处理。第二种方法是，忽略某个信号，对该信号不做任何处理，就象未发生过一样。第三种方法是，对该信号的处理保留系统的默认值，这种缺省操作，对大部分的信 号的缺省操作是使得进程终止。进程通过系统调用signal来指定进程对某个信号的处理行为。 <br/>
　　在进程表的表项中有一个软中断信号域，该域中每一位对应一个信号，当有信号发送给进程时，对应位置位。由此可以看出，进程对不同的信号可以同时保留，但对于同一个信号，进程并不知道在处理之前来过多少个。 <br/>
　　发出信号的原因很多，这里按发出信号的原因简单分类，以了解各种信号： <br/>
　　①与进程终止相关的信号。当进程退出，或者子进程终止时，发出这类信号。 <br/>
　　②与进程例外事件相关的信号。如进程越界，或企图写一个只读的内存区域（如程序正文区），或执行一个特权指令及其他各种硬件错误。 <br/>
　　③与在系统调用期间遇到不可恢复条件相关的信号。如执行系统调用exec时，原有资源已经释放，而目前系统资源又已经耗尽。 <br/>
　　④与执行系统调用时遇到非预测错误条件相关的信号。如执行一个并不存在的系统调用。 <br/>
　　⑤在用户态下的进程发出的信号。如进程调用系统调用kill向其他进程发送信号。 <br/>
　　⑥与终端交互相关的信号。如用户关闭一个终端，或按下break键等情况。 <br/>
　　⑦跟踪进程执行的信号。</p>

<p>相关函数和头文件:<br/>
　　①signal.h<br/>
　　系统调用signal用来设定某个信号的处理方法。该调用声明的格式如下：<br/>
　　　　void (*signal(int signum, void (*handler)(int)))(int); </p>

<p>　　在使用该调用的进程中加入以下头文件： <br/>
　　#include &quot;signal.h&quot;</p>

<p>　　②sigaction函数<br/>
　　int sigaction(int signo,const struct sigaction *restrict act,struct sigaction *restrict oact);<br/>
　　sigaction函数用于改变进程接收到特定信号后的行为。该函数的第一个参数为信号的值，可以为除SIGKILL及SIGSTOP外的任何一个特定有效的信号（为这两个信号定义自己的处理函数，将导致信号安装错误）。第二个参数是指向结构sigaction的一个实例的指针，在结构sigaction的实例中，指定了对特定信号的处理，可以为空，进程会以缺省方式对信号处理；第三个参数oldact指向的对象用来保存返回的原来对相应信号的处理，可指定oldact为NULL。如果把第二、第三个参数都设为NULL，那么该函数可用于检查信号的有效性.第二个参数最为重要，其中包含了对指定信号的处理、信号所传递的信息、信号处理函数执行过程中应屏蔽掉哪些信号等等。<br/>
结构sigaction定义如下：</p>

<blockquote>
<pre><code>struct sigaction{
    void (*sa_handler)(int);
    sigset_t sa_mask;
    int sa_flag;
    void (*sa_sigaction)(int,siginfo_t *,void *);
};
</code></pre>
</blockquote>

<p>sa_handler字段包含一个信号捕捉函数的地址<br/>
sa_mask字段说明了一个信号集，在调用该信号捕捉函数之前，这一信号集要加进进程的信号屏蔽字中。仅当从信号捕捉函数返回时再将进程的信号屏蔽字复位为原先值。<br/>
sa_flag是一个选项，主要理解两个:<br/>
　　　　SA_INTERRUPT 由此信号中断的系统调用不会自动重启<br/>
　　　　SA_RESTART 由此信号中断的系统调用会自动重启<br/>
　　　　SA_SIGINFO 提供附加信息，一个指向siginfo结构的指针以及一个指向进程上下文标识符的指针<br/>
最后一个参数是一个替代的信号处理程序，当设置SA_SIGINFO时才会用他。</p>

<p>③sigemptyset <br/>
　　函数初始化信号集合set，将set 设置为空。 </p>

<p>④信号所传递的每一个整数都被赋予了特殊的意义，并有一个信号名对应该整数。常见的信号有SIGINT, SIGQUIT, SIGCONT, SIGTSTP, SIGALRM等。这些都是信号的名字。你可以通过$man 7 signal来查阅更多的信号。上面几个信号中，<br/>
　　<strong>SIGINT   当键盘按下CTRL+C从shell中发出信号，信号被传递给shell中前台运行的进程，对应该信号的默认操作是中断 (INTERRUPT) 该进程。</strong><br/>
　　<strong>SIGQUIT  当键盘按下CTRL+\从shell中发出信号，信号被传递给shell中前台运行的进程，对应该信号的默认操作是退出 (QUIT) 该进程。</strong><br/>
　　SIGTSTP  当键盘按下CTRL+Z从shell中发出信号，信号被传递给shell中前台运行的进程，对应该信号的默认操作是暂停 (STOP) 该进程。 <br/>
　　<strong>SIG_DFL：默认信号处理程序</strong><br/>
　　SIG_IGN：忽略信号的处理程序<br/>
　　SIGCONT  用于通知暂停的进程继续。<br/>
　　SIGALRM  起到定时器的作用，通常是程序在一定的时间之后才生成该信号。</p>

<p>⑤kill()<br/>
　　原型:int kill(pid_t pid,int signo)<br/>
　　作用:该系统调用可以用来向任何进程或进程组发送任何信号。参数pid的值为信号的接收进程;sinno是信号值，当为0时（即空信号），实际不发送任何信号，但照常进行错误检查，因此，可用于检查目标进程是否存在，以及当前进程是否具有向目标发送信号的权限（root权限的进程可以向任何进程发送信号，非root权限的进程只能向属于同一个session或者同一个用户的进程发送信号）。<br/>
⑥pause()<br/>
　　阻塞进程,直到有信号产生</p>

<h4 id="toc_1">1.接收SIGINT信号,始终执行自定义处理</h4>

<p>任务描述:</p>

<ul>
<li>打印字符串,忽略ctrl+c的中断信号</li>
</ul>

<p>main.c:</p>

<blockquote>
<pre><code>#include &quot;signal.h&quot;
#include &quot;stdio.h&quot;
#include &quot;unistd.h&quot;
#include &quot;stdlib.h&quot;
struct sigaction act;
void doit(int sig){
    printf(&quot;ha ha you can&#39;t close me\n&quot;);
}
int main(void){
    act.sa_handler=doit;
    sigemptyset(&amp;act.sa_mask);
    act.sa_flags=0;
    if(sigaction(SIGINT,&amp;act,NULL)!=0){
        perror(&quot;sigaction error\n&quot;);
        exit(1);
    }
    while(1){
        printf(&quot;hello,world\n&quot;);
        sleep(1);   
    }
    return 0;
}
</code></pre>
</blockquote>

<h4 id="toc_2">2.接收SIGINT信号,执行一次自定义处理后,恢复默认行为</h4>

<p>任务描述:</p>

<ul>
<li>打印字符串,第一次按ctrl+c没有用,第二次按生效</li>
</ul>

<p>main.c:</p>

<blockquote>
<pre><code>#include &quot;signal.h&quot;
#include &quot;stdio.h&quot;
#include &quot;unistd.h&quot;
#include &quot;stdlib.h&quot;
struct sigaction act;
void doit(int sig){
    printf(&quot;ha ha you can&#39;t close me\n&quot;);
    act.sa_handler=SIG_DFL;
    sigaction(SIGINT,&amp;act,NULL);
}
int main(void) {
    struct sigaction act;
    act.sa_handler=doit;
    sigemptyset(&amp;act.sa_mask);
    act.sa_flags=0;
    if(sigaction(SIGINT,&amp;act,NULL)!=0){
        perror(&quot;sigaction error\n&quot;);
        exit(1);
    }
    while(1){
        printf(&quot;hello,world\n&quot;);
        sleep(1);   
    }
    return 0;
}
</code></pre>
</blockquote>

<h4 id="toc_3">3.模拟时钟</h4>

<p>任务描述:</p>

<ul>
<li>在5秒内,如果没有接受到其他信号,则提示时间到了</li>
</ul>

<p>main.c:</p>

<blockquote>
<pre><code>#include &quot;signal.h&quot;
#include &quot;stdio.h&quot;
#include &quot;unistd.h&quot;
#include &quot;stdlib.h&quot; 
struct sigaction act;
void doit(int sig){
    printf(&quot;It&#39;s time to get up\n&quot;);
}
int main(void) {
    act.sa_handler=doit;
    sigemptyset(&amp;act.sa_mask);
    act.sa_flags=0;
    if(sigaction(SIGALRM,&amp;act,NULL)!=0){
        perror(&quot;sigaction error\n&quot;);
        exit(1);
    }
    pid_t pid;
    pid=fork();
    if(pid&lt;0){
        printf(&quot;error\n&quot;);
        return -1;
    }
    if(pid==0){
        sleep(5);
        kill(getppid(),SIGALRM);      
    }else{
        printf(&quot;get a signal\n&quot;);
        pause();
    }  
    return 0;
}
</code></pre>
</blockquote>

<h4 id="toc_4">4.带有超时功能的read</h4>

<p>任务描述:</p>

<ul>
<li>在5秒内输入字符串,否则提示超时</li>
</ul>

<p>相关知识:<br/>
　　①setjmp.h是C标准函数库中提供“非本地跳转”的头文件：控制流偏离了通常的子程序调用与返回序列。互补的两个函数setjmp与longjmp提供了这种功能。<br/>
　　setjmp/longjmp的典型用途是异常处理机制的实现：利用longjmp恢复程序或线程的状态，甚至可以跳过栈中多层的函数调用。<br/>
　　在信号处理机制中，进程在检查收到的信号，会从原来的系统调用中直接返回，而不是等到该调用完成。这种进程突然改变其上下文的情况，就是通过使用setjmp和longjmp来实现的。setjmp将保存的上下文载入用户空间，并继续在旧的上下文中继续执行。这就是说，进程执行一个系统调用，当因为资源或其他原因要去睡眠时，内核为进程作了一次setjmp，如果在睡眠中被信号唤醒，进程不能再进入睡眠时，内核为进程调用longjmp，该操作是内核为进程将现在的上下文切换成原先通过setjmp调用保存在进程用户区的上下文，这样就使得进程可以恢复等待资源前的状态，而且内核为setjmp返回1，使得进程知道该次系统调用失败。另一种用在多线程程序中同步访问的方法是使用互斥量。它允许程序员锁住某个对象，使得每次只能有一个线程访问它。为了控制对关键代码的访问，必须在进入这段代码之前锁住一个互斥量，然后在完成操作之后解锁它。</p>

<p>　　②int setjmp(jmp_buf env)<br/>
　　建立本地的jmp_buf缓冲区并且初始化，用于将来跳转回此处。这个子程序[保存程序的调用环境于env参数所指的缓冲区，env将被longjmp使用。<strong>如果是从setjmp直接调用返回，setjmp返回值为0。如果是从longjmp恢复的程序调用环境返回，setjmp返回非零值。</strong><br/>
　　void longjmp(jmp_buf env, int value) 恢复env所指的缓冲区中的程序调用环境上下文，env所指缓冲区的内容是由setjmp子程序[1]调用所保存。value的值从longjmp传递给setjmp。longjmp完成后，程序从对应的setjmp调用处继续执行，如同setjmp调用刚刚完成。<strong>如果value传递给longjmp零值，setjmp的返回值为1；否则，setjmp的返回值为value。</strong><br/>
　　setjmp保存当前的环境（即程序的状态）到平台相关的一个数据结构 (jmp_buf)，该数据结构在随后程序执行的某一点可被 longjmp用于恢复程序的状态到setjmp调用所保存到jmp_buf时的原样。这一过程可以认为是&quot;跳转&quot;回setjmp所保存的程序执行状态。setjmp的返回值指出控制是正常到达该点还是通过调用longjmp恢复到该点。因此有编程的惯用法: if( setjmp(x) ){/* handle longjmp(x) */}。 <br/>
　　jmp_buf 数组类型，例如struct int[16]或struct __jmp_buf_tag[3]，用于保存恢复调用环境所需的信息。<br/>
　　③alarm也称为闹钟函数，它可以再进程中设置一个定时器，当定时器指定的时间到时，它向进程发送SIGALARM信号。要注意的是，一个进程只能有一个闹钟时间，如果在调用alarm之前已设置过闹钟时间，则任何以前的闹钟时间都被新值所代替。当在调用alarm()前已经设置了一个闹钟，那么我们可以调用alarm(0)来取消此闹钟，并返回剩余时间。<br/>
　　函数原型<br/>
　　　　unsigned int alarm（unsigned int seconds)<br/>
　　函数参数<br/>
　　　　seconds:指定秒数<br/>
　　函数返回值<br/>
　　　　成功：如果调用此alarm（）前，进程已经设置了闹钟时间，则返回上一个闹钟时间的剩余时间，否则返回0。<br/>
　　　　出错：-1</p>

<p>main.c:</p>

<blockquote>
<pre><code>#include &quot;signal.h&quot;     //signal() 
#include &quot;stdio.h&quot;      //perror
#include &quot;unistd.h&quot;     //read(), write(), alarm()
#include &quot;stdlib.h&quot;     //exit() 
#include &quot;setjmp.h&quot;     // setjmp(), lonjmp() 
#define MAXLINE 80
struct sigaction act;
jmp_buf myjmp;
void sig_alrm(int sig){
    longjmp(myjmp,1);    
    exit(0);
}
int main(void){
    int n;
    char a[MAXLINE];
    act.sa_handler=sig_alrm;
    sigemptyset(&amp;act.sa_mask);
    act.sa_flags=0;
    if(sigaction(SIGALRM,&amp;act,NULL)!=0){
        perror(&quot;sigaction error\n&quot;);
        exit(1);
    }
    //setjmp一开始默认是0
    if (setjmp(myjmp) != 0){
        printf(&quot;read timeout\n&quot;);
        exit(0);
    }
    alarm(5);//指定时间到时发送SIGSLARM信号,若5秒内执行到了alarm(0)则取消发送alarm信号，否则进入子函数的longjmp返回1到setjmp，退出整个程序
    printf(&quot;please input something in 5 seconds\n&quot;);    
    n=read(0,a,sizeof(a));
    alarm(0);
    printf(&quot;your input string is :\n&quot;);
    write(1,a,n);
    exit(0);
}
</code></pre>
</blockquote>

<h4 id="toc_5">5.屏蔽SIGINT信号,当来SIGINT信号后,恢复所有信号的正常处理</h4>

<p>任务描述:</p>

<ul>
<li>sigsuspend屏蔽SIGINT信号,并挂起进程,然后SIGQUIT信号来之后开始正常处理</li>
</ul>

<p>相关知识:<br/>
sigsuspend()<br/>
　　函数原型<br/>
　　　　int sigsuspend(const sigset_t *mask);<br/>
　　作用<br/>
　　　　用于在接收到某个信号之前，临时用mask替换进程的信号掩码，并暂停进程执行，直到收到信号为止。也就是说，进程执行到sigsuspend时，sigsuspend并不会立刻返回，进程处于TASK_INTERRUPTIBLE状态并立刻放弃CPU，等待UNBLOCK（mask之外的）信号的唤醒。进程在接收到UNBLOCK（mask之外）信号后，调用处理函数，然后把现在的信号集还原为原来的，sigsuspend返回，进程恢复执行。<br/>
　　返回值<br/>
　　　　sigsuspend返回后将恢复调用之前的的信号掩码。信号处理函数完成后，进程将继续执行。该系统调用始终返回-1，并将errno设置为EINTR.</p>

<p>main.c:</p>

<blockquote>
<pre><code>#include &quot;signal.h&quot;
#include &quot;stdio.h&quot;
#include &quot;unistd.h&quot;
#include &quot;stdlib.h&quot; 
struct sigaction act,act2;
void sig_int(int sig){
    act2.sa_handler=SIG_DFL;
    sigaction(SIGINT,&amp;act2,NULL);
}
void sig_quit(int sig){
    act.sa_handler=SIG_DFL;
    sigaction(SIGQUIT,&amp;act,NULL);
}
int main(void){
    sigset_t newmask;
    sigemptyset(&amp;newmask);
    act.sa_handler=sig_quit;
    sigemptyset(&amp;act.sa_mask);
    act.sa_flags=0;
    act2.sa_handler=sig_int;
    sigemptyset(&amp;act2.sa_mask);
    act2.sa_flags=0;
    if(sigaction(SIGINT,&amp;act2,NULL)!=0){
        perror(&quot;sigaction sigint error\n&quot;);
        exit(0);
    }
    if(sigaction(SIGQUIT,&amp;act,NULL)!=0){
        perror(&quot;sigaction sigquit error\n&quot;);
        exit(0);
    }
    sigaddset(&amp;newmask, SIGINT);//SIGINT信号加入到new信号集中
    printf(&quot;get signal\n&quot;);
    sigsuspend(&amp;newmask);
    printf(&quot;\n&quot;);
    while(1){
        printf(&quot;hello\n&quot;);
        sleep(1);
    }
    return 0;
}
</code></pre>
</blockquote>

<h4 id="toc_6">6.将程序阻塞期间产生的信号推迟到阻塞之后处理</h4>

<p>任务描述:</p>

<ul>
<li>slee 5s期间产生SIGQUIT不立即处理,5s后再处理,处理要先自定义打印消息,然后恢复默认设置</li>
<li>然后将屏蔽信号恢复,sleep 10s,这期间产生的SIGQUIT信号,将直接执行</li>
</ul>

<p>相关知识:<br/>
　　①sigemptyset <br/>
　　函数初始化信号集合set，将set 设置为空。<br/>
　　②信号屏蔽字是指一个进程中当前阻塞而不能够递送给该进程的信号集。信号集则是一个能表示多个信号的集合的一种数据类型，为sigset_t。<br/>
　　与信号集设置相关的函数有如下几个：<br/>
　　 下列四个函数成功返回0，出错返回-1<br/>
　　　int sigemptyset(sigset_t *set);<br/>
　　　int sigfillset(sigset_t *set);<br/>
　　　int sigaddset(sigset_t *set, int signo);<br/>
　　　int sigdelset(sigset_t *set, int signo);<br/>
　　 下面函数若真返回1，若假返回0，出错返回-1<br/>
　　　int sigismember(const sigset_t *set, int signo);<br/>
　　③int sigaddset(sigset_t *set,int signum);<br/>
　　　　sigaddset()用来将参数signum 代表的信号加入至参数set 信号集里。<br/>
　　④sigprocmask<br/>
　　功能：<br/>
　　　　检测或更改信号屏蔽字<br/>
　　头文件：<br/>
　　　　#include &quot;signal.h&quot;<br/>
　　函数原型：<br/>
　　　　int sigprocmask(int how,const sigsett_t *set,sigset_t *oldset);<br/>
　　参数：<br/>
　　　　how  操作方式<br/>
　　　　set   信号集<br/>
　　　　oldest<br/>
　　返回值：<br/>
　　　　若成功返回0，若出错返回-1。<br/>
　　每个进程都有一个用来描述哪些信号递送到进程时将被阻塞的信号集，该信号集中的所有信号在递送到进程后都将被阻塞。sigprocmask是最为关键的一个函数。在使用之前要先设置好信号集合set。这个函数的作用是将指定的信号集合set加入到进程的信号阻塞集合之中去，如果提供了oldset那么当前的进程信号阻塞集合将会保存在oldset里面。参数how决定函数的操作方式。<br/>
　　SIG_BLOCK：增加一个信号集合到当前进程的阻塞集合之中。<br/>
　　SIG_UNBLOCK：从当前的阻塞集合之中删除一个信号集合。<br/>
　　SIG_SETMASK：将当前的信号集合设置为信号阻塞集合。</p>

<p>main.c:</p>

<blockquote>
<pre><code>#include &quot;signal.h&quot;
#include &quot;stdio.h&quot;
#include &quot;unistd.h&quot;
#include &quot;stdlib.h&quot; 
struct sigaction act;
void doit(int sig){
    printf(&quot;caught sigquit\n&quot;);
    act.sa_handler=SIG_DFL;
    sigemptyset(&amp;act.sa_mask);
    act.sa_flags=0;
    //接收SIGQUIT信号并执行doit函数
    if(sigaction(SIGQUIT,&amp;act,0)&lt;0){
        perror(&quot;recover sigquiut error\n&quot;); 
        exit(1);
    }    
}
int main(void){
    sigset_t newmask,oldmask,pendmask;
    act.sa_handler=doit;
    sigemptyset(&amp;act.sa_mask);
    act.sa_flags=0;
    //接受到SIGQUIT信号则执行doit函数
    if(sigaction(SIGQUIT,&amp;act,NULL)!=0){
        perror(&quot;sigaction error\n&quot;);
        exit(0);
    }
    sigemptyset(&amp;newmask);
    sigaddset(&amp;newmask, SIGQUIT);//SIGINT信号加入到newmask信号集中
    //将newmask信号集中的信号设为阻塞信号
    if(sigprocmask(SIG_BLOCK,&amp;newmask,&amp;oldmask)&lt;0){
        perror(&quot;sigprocmask error\n&quot;);
        exit(1);
    }
    printf(&quot;block SIGQUIT 5s\n&quot;) ;
    sleep(5);
    //查看阻塞的信号
    if(sigpending(&amp;pendmask)&lt;0){
        perror(&quot;sigpending error\n&quot;);
        exit(1);
    }
    //查看阻塞的信号中有没有SIGQUIT
    if(sigismember(&amp;pendmask,SIGQUIT))
        printf(&quot;SIGQUIT pending\n&quot;);
    printf(&quot;sigquit unblocked\n&quot;);
    //将阻塞的信号释放
    if(sigprocmask(SIG_SETMASK,&amp;oldmask,NULL)&lt;0){
        perror(&quot;set oldmask error\n&quot;);
        exit(1);
    } 
    printf(&quot;program will sleep 10s,during these SIGQUIT won&#39;t be blocked\n&quot;); 
    sleep(10);
    printf(&quot;done\n&quot;); 
    return 0;
}
</code></pre>
</blockquote>


</div>

<br /><br />
<hr />

<div class="row clearfix">
  <div class="large-6 columns">
	<div class="text-left" style="padding:15px 0px;">
		
	        <a href="15033227559982.html"  title="Previous Post: 使用virt-manager创建和管理虚拟机">&laquo; 使用virt-manager创建和管理虚拟机</a>
	    
	</div>
  </div>
  <div class="large-6 columns">
	<div class="text-right" style="padding:15px 0px;">
		
	        <a href="15033226512813.html" 
	        title="Next Post: 僵尸进程和孤儿进程">僵尸进程和孤儿进程 &raquo;</a>
	    
	</div>
  </div>
</div>

<div class="row">
<div style="padding:0px 0.93em;" class="share-comments">

</div>
</div>
<script type="text/javascript">
	$(function(){
		var currentURL = '15033227238921.html';
		$('#side-nav a').each(function(){
			if($(this).attr('href') == currentURL){
				$(this).parent().addClass('active');
			}
		});
	});
</script>  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    <script src="asset/chart/all-min.js"></script><script type="text/javascript">$(function(){    var mwebii=0;    var mwebChartEleId = 'mweb-chart-ele-';    $('pre>code').each(function(){        mwebii++;        var eleiid = mwebChartEleId+mwebii;        if($(this).hasClass('language-sequence')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = Diagram.parse($(this).text());            diagram.drawSVG(eleiid,{theme: 'simple'});        }else if($(this).hasClass('language-flow')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = flowchart.parse($(this).text());            diagram.drawSVG(eleiid);        }    });});</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>

  </body>
</html>
